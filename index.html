<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>赛博深渊：极限挑战</title>
    <style>
        :root {
            --neon-blue: #0ff0fc;
            --neon-pink: #ff2a6d;
            --neon-purple: #9d00ff;
            --dark-bg: #0a0a20;
            --panel-bg: rgba(10, 10, 30, 0.8);
        }
        body {
            background: var(--dark-bg);
            color: white;
            font-family: 'Courier New', monospace;
            overflow-x: hidden;
            margin: 0;
            padding: 10px;
        }
        .cyber-panel {
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 10px var(--neon-pink);
            background: var(--panel-bg);
            padding: 1rem;
            margin: 1rem 0;
            position: relative;
            border-radius: 5px;
        }
        .cyber-panel::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--neon-blue), var(--neon-pink));
        }
        .resource {
            display: inline-block;
            margin: 0 1rem;
            text-shadow: 0 0 5px var(--neon-blue);
        }
        button {
            background: black;
            color: var(--neon-blue);
            border: 1px solid var(--neon-blue);
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
            font-family: 'Courier New', monospace;
            border-radius: 3px;
        }
        button:hover {
            background: var(--neon-blue);
            color: black;
            box-shadow: 0 0 10px var(--neon-blue);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        #game-over {
            display: none;
            color: var(--neon-pink);
            font-size: 2rem;
            text-align: center;
            animation: glitch 1s linear infinite;
        }
        @keyframes glitch {
            0% { text-shadow: 2px 0 var(--neon-blue); }
            20% { text-shadow: -2px 0 var(--neon-pink); }
            40% { text-shadow: 2px 0 var(--neon-purple); }
            60% { text-shadow: -2px 0 var(--neon-blue); }
            80% { text-shadow: 2px 0 var(--neon-pink); }
            100% { text-shadow: -2px 0 var(--neon-purple); }
        }
        .progress-bar {
            height: 20px;
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--neon-blue);
            margin: 10px 0;
            position: relative;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-blue), var(--neon-pink));
            width: 0%;
            transition: width 0.3s;
        }
        .event-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            background: var(--dark-bg);
            border: 2px solid var(--neon-pink);
            padding: 20px;
            width: 80%;
            max-width: 500px;
            text-align: center;
        }
        .tech-tree {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .tech-item {
            border: 1px solid var(--neon-purple);
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .tech-item:hover {
            box-shadow: 0 0 10px var(--neon-purple);
        }
        .tech-item.unlocked {
            border-color: var(--neon-blue);
            background: rgba(15, 240, 252, 0.1);
        }
        .tech-item.locked {
            opacity: 0.5;
        }
        #hack-code {
            font-size: 2rem;
            letter-spacing: 5px;
            margin: 20px 0;
            color: var(--neon-pink);
        }
        #hack-input {
            background: black;
            color: var(--neon-blue);
            border: 1px solid var(--neon-blue);
            padding: 10px;
            font-size: 1.2rem;
            width: 200px;
            text-align: center;
            font-family: 'Courier New', monospace;
        }
        .tab-container {
            display: flex;
            margin-bottom: 10px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid var(--neon-blue);
            margin-right: 5px;
        }
        .tab.active {
            background: var(--neon-blue);
            color: black;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .upgrade {
            border: 1px solid var(--neon-blue);
            padding: 10px;
            margin: 5px 0;
            cursor: pointer;
        }
        .upgrade:hover {
            background: rgba(15, 240, 252, 0.1);
        }
        .upgrade.unlocked {
            border-color: var(--neon-pink);
        }
        .upgrade.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .achievement {
            border: 1px solid var(--neon-purple);
            padding: 10px;
            margin: 5px 0;
            opacity: 0.5;
        }
        .achievement.unlocked {
            opacity: 1;
            box-shadow: 0 0 10px var(--neon-purple);
        }
    </style>
</head>
<body>
    <div id="game-over">
        <h1>系统崩溃</h1>
        <p>你的赛博帝国已经瓦解...</p>
        <button onclick="resetGame()">重建系统</button>
    </div>

    <div class="event-panel" id="hack-event">
        <h2>黑客入侵!</h2>
        <p>快速输入以下代码阻止数据泄露:</p>
        <div id="hack-code">XXXXXX</div>
        <input type="text" id="hack-input" maxlength="6">
        <p id="hack-timer">剩余时间: 10秒</p>
        <button onclick="resolveHack(true)">确认</button>
    </div>

    <div class="event-panel" id="overload-event">
        <h2>系统过载!</h2>
        <p>你的算力使用已达到危险水平!</p>
        <div class="progress-bar">
            <div class="progress-fill" id="overload-bar"></div>
        </div>
        <p>快速点击降温按钮防止系统崩溃!</p>
        <button onclick="coolSystem()">紧急降温</button>
        <p id="overload-timer">倒计时: 10秒</p>
    </div>

    <h1 style="text-align: center; text-shadow: 0 0 10px var(--neon-blue);">赛博深渊：极限挑战</h1>

    <div class="tab-container">
        <div class="tab active" onclick="switchTab('main')">主控台</div>
        <div class="tab" onclick="switchTab('tech')">科技树</div>
        <div class="tab" onclick="switchTab('upgrades')">升级</div>
        <div class="tab" onclick="switchTab('achievements')">成就</div>
    </div>

    <div class="tab-content active" id="main-tab">
        <div class="cyber-panel">
            <h2>资源监控</h2>
            <div>
                <span class="resource">能源: <span id="energy">0</span></span>
                <span class="resource">数据碎片: <span id="data">0</span></span>
                <span class="resource">算力: <span id="compute">0</span>/<span id="max-compute">100</span></span>
                <span class="resource">信用点: <span id="credits">0</span></span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="compute-bar"></div>
            </div>
            <p>系统稳定性: <span id="stability">100</span>%</p>
        </div>

        <div class="cyber-panel">
            <h2>核心设施</h2>
            <button onclick="buyGenerator()">建造能源发生器 (消耗: 50信用点)</button>
            <button onclick="buyDataCenter()">建造数据中心 (消耗: 100信用点)</button>
            <button onclick="buyQuantumComputer()">建造量子计算机 (消耗: 500信用点)</button>
            <button onclick="buyFirewall()">升级防火墙 (消耗: 200数据碎片)</button>
            
            <div style="margin-top: 20px;">
                <h3>自动化设置</h3>
                <label>
                    <input type="checkbox" id="auto-energy"> 自动分配能源
                </label>
                <label>
                    <input type="checkbox" id="auto-data"> 自动分析数据
                </label>
            </div>
        </div>

        <div class="cyber-panel">
            <h2>行动</h2>
            <button onclick="harvestEnergy()">收集能源</button>
            <button onclick="mineData()">挖掘数据</button>
            <button onclick="runComputation()">执行计算</button>
            <button onclick="sellData()">出售数据 (10数据碎片 = 1信用点)</button>
            <button onclick="buyCredits()">黑市交易 (高风险)</button>
        </div>

        <div class="cyber-panel">
            <h2>日志</h2>
            <div id="log" style="height: 100px; overflow-y: scroll; border: 1px solid var(--neon-blue); padding: 5px;">
                <p>系统启动... 欢迎来到赛博深渊</p>
            </div>
        </div>
    </div>

    <div class="tab-content" id="tech-tab">
        <div class="cyber-panel">
            <h2>科技树</h2>
            <p>研究点数: <span id="research-points">0</span></p>
            <div class="tech-tree">
                <div class="tech-item locked" id="tech-ai" onclick="researchTech('ai')">
                    <h3>基础AI</h3>
                    <p>解锁自动化功能</p>
                    <p>需求: 10研究点数</p>
                </div>
                <div class="tech-item locked" id="tech-quantum" onclick="researchTech('quantum')">
                    <h3>量子计算</h3>
                    <p>算力上限+200%</p>
                    <p>稳定性-20%</p>
                    <p>需求: 25研究点数</p>
                </div>
                <div class="tech-item locked" id="tech-neural" onclick="researchTech('neural')">
                    <h3>神经链接</h3>
                    <p>资源获取速度+50%</p>
                    <p>黑客风险+30%</p>
                    <p>需求: 20研究点数</p>
                </div>
                <div class="tech-item locked" id="tech-darkweb" onclick="researchTech('darkweb')">
                    <h3>暗网接入</h3>
                    <p>解锁黑市交易</p>
                    <p>系统风险+40%</p>
                    <p>需求: 15研究点数</p>
                </div>
                <div class="tech-item locked" id="tech-nanotech" onclick="researchTech('nanotech')">
                    <h3>纳米科技</h3>
                    <p>设施效率+30%</p>
                    <p>维护成本+50%</p>
                    <p>需求: 40研究点数</p>
                </div>
                <div class="tech-item locked" id="tech-singularity" onclick="researchTech('singularity')">
                    <h3>技术奇点</h3>
                    <p>解锁终极能力</p>
                    <p>系统极度不稳定</p>
                    <p>需求: 100研究点数</p>
                </div>
            </div>
        </div>
    </div>

    <div class="tab-content" id="upgrades-tab">
        <div class="cyber-panel">
            <h2>设施升级</h2>
            <div class="upgrade locked" id="upgrade-gen1" onclick="buyUpgrade('gen1')">
                <h3>能源发生器 Mk.II</h3>
                <p>能源产出+50%</p>
                <p>成本: 200信用点</p>
            </div>
            <div class="upgrade locked" id="upgrade-data1" onclick="buyUpgrade('data1')">
                <h3>数据中心 Mk.II</h3>
                <p>数据处理+50%</p>
                <p>成本: 300信用点</p>
            </div>
            <div class="upgrade locked" id="upgrade-quant1" onclick="buyUpgrade('quant1')">
                <h3>量子优化</h3>
                <p>算力效率+30%</p>
                <p>成本: 500信用点</p>
            </div>
            <div class="upgrade locked" id="upgrade-firewall1" onclick="buyUpgrade('firewall1')">
                <h3>高级防火墙</h3>
                <p>黑客风险-40%</p>
                <p>成本: 400数据碎片</p>
            </div>
        </div>
    </div>

    <div class="tab-content" id="achievements-tab">
        <div class="cyber-panel">
            <h2>成就系统</h2>
            <div class="achievement" id="achieve-start">
                <h3>初次启动</h3>
                <p>启动你的第一个设施</p>
            </div>
            <div class="achievement" id="achieve-hack">
                <h3>防火墙测试</h3>
                <p>成功抵御一次黑客攻击</p>
            </div>
            <div class="achievement" id="achieve-overload">
                <h3>冷静应对</h3>
                <p>防止系统过载崩溃</p>
            </div>
            <div class="achievement" id="achieve-quantum">
                <h3>量子跃迁</h3>
                <p>研究量子计算技术</p>
            </div>
            <div class="achievement" id="achieve-singularity">
                <h3>奇点临近</h3>
                <p>达到技术奇点</p>
            </div>
        </div>
    </div>

    <script>
        // 游戏状态
        const game = {
            resources: {
                energy: 0,
                data: 0,
                compute: 0,
                maxCompute: 100,
                credits: 50,
                research: 0
            },
            facilities: {
                generators: 0,
                dataCenters: 0,
                quantumComputers: 0,
                firewalls: 0
            },
            rates: {
                energy: 0,
                data: 0,
                compute: 0
            },
            upgrades: {
                gen1: false,
                data1: false,
                quant1: false,
                firewall1: false
            },
            tech: {
                ai: false,
                quantum: false,
                neural: false,
                darkweb: false,
                nanotech: false,
                singularity: false
            },
            achievements: {
                start: false,
                hack: false,
                overload: false,
                quantum: false,
                singularity: false
            },
            stability: 100,
            lastUpdate: Date.now(),
            hackActive: false,
            overloadActive: false,
            hackTime: 0,
            overloadTime: 0,
            gameOver: false
        };

        // 加载游戏
        function loadGame() {
            const saved = localStorage.getItem('cyberAbyss');
            if (saved) {
                const parsed = JSON.parse(saved);
                Object.assign(game, parsed);
                updateUI();
                addLog("游戏加载完成");
            }
        }

        // 保存游戏
        function saveGame() {
            localStorage.setItem('cyberAbyss', JSON.stringify(game));
        }

        // 重置游戏
        function resetGame() {
            if (confirm("确定要重置游戏吗？所有进度将丢失！")) {
                localStorage.removeItem('cyberAbyss');
                location.reload();
            }
        }

        // 更新UI
        function updateUI() {
            // 资源显示
            document.getElementById('energy').textContent = Math.floor(game.resources.energy);
            document.getElementById('data').textContent = Math.floor(game.resources.data);
            document.getElementById('compute').textContent = Math.floor(game.resources.compute);
            document.getElementById('max-compute').textContent = game.resources.maxCompute;
            document.getElementById('credits').textContent = Math.floor(game.resources.credits);
            document.getElementById('research-points').textContent = Math.floor(game.resources.research);
            document.getElementById('stability').textContent = Math.floor(game.stability);
            
            // 进度条
            const computePercent = (game.resources.compute / game.resources.maxCompute) * 100;
            document.getElementById('compute-bar').style.width = `${computePercent}%`;
            
            // 设施状态
            document.getElementById('auto-energy').checked = game.tech.ai;
            document.getElementById('auto-data').checked = game.tech.ai;
            
            // 科技树
            updateTechTree();
            
            // 升级
            updateUpgrades();
            
            // 成就
            updateAchievements();
            
            // 游戏状态
            if (game.gameOver) {
                document.getElementById('game-over').style.display = 'block';
            } else {
                document.getElementById('game-over').style.display = 'none';
            }
        }

        // 更新科技树
        function updateTechTree() {
            const techItems = ['ai', 'quantum', 'neural', 'darkweb', 'nanotech', 'singularity'];
            techItems.forEach(tech => {
                const element = document.getElementById(`tech-${tech}`);
                if (game.tech[tech]) {
                    element.classList.add('unlocked');
                    element.classList.remove('locked');
                } else {
                    element.classList.remove('unlocked');
                    // 检查是否满足研究条件
                    const canResearch = canResearchTech(tech);
                    element.classList.toggle('locked', !canResearch);
                }
            });
        }

        // 检查是否可以研究科技
        function canResearchTech(tech) {
            const requirements = {
                ai: game.resources.research >= 10,
                quantum: game.resources.research >= 25,
                neural: game.resources.research >= 20,
                darkweb: game.resources.research >= 15,
                nanotech: game.resources.research >= 40 && game.tech.ai && game.tech.neural,
                singularity: game.resources.research >= 100 && game.tech.quantum && game.tech.nanotech
            };
            return requirements[tech] && !game.tech[tech];
        }

        // 研究科技
        function researchTech(tech) {
            if (!canResearchTech(tech)) return;
            
            const costs = {
                ai: 10,
                quantum: 25,
                neural: 20,
                darkweb: 15,
                nanotech: 40,
                singularity: 100
            };
            
            game.resources.research -= costs[tech];
            game.tech[tech] = true;
            
            // 应用科技效果
            switch(tech) {
                case 'ai':
                    addLog("AI系统已上线，自动化功能解锁");
                    break;
                case 'quantum':
                    game.resources.maxCompute *= 3;
                    game.stability -= 20;
                    addLog("量子计算技术已激活 - 算力上限大幅提升，但系统稳定性下降");
                    unlockAchievement('quantum');
                    break;
                case 'neural':
                    addLog("神经链接已建立 - 资源获取速度提升");
                    break;
                case 'darkweb':
                    addLog("暗网接入成功 - 高风险交易选项已解锁");
                    break;
                case 'nanotech':
                    addLog("纳米科技已部署 - 设施效率提升");
                    break;
                case 'singularity':
                    game.stability -= 40;
                    addLog("警告: 技术奇点已达成 - 系统极度不稳定");
                    unlockAchievement('singularity');
                    break;
            }
            
            updateUI();
            saveGame();
        }

        // 更新升级
        function updateUpgrades() {
            const upgrades = ['gen1', 'data1', 'quant1', 'firewall1'];
            upgrades.forEach(upgrade => {
                const element = document.getElementById(`upgrade-${upgrade}`);
                if (game.upgrades[upgrade]) {
                    element.classList.add('unlocked');
                    element.classList.remove('locked');
                } else {
                    // 检查是否满足升级条件
                    const canUpgrade = canBuyUpgrade(upgrade);
                    element.classList.toggle('locked', !canUpgrade);
                }
            });
        }

        // 检查是否可以购买升级
        function canBuyUpgrade(upgrade) {
            const requirements = {
                gen1: game.facilities.generators >= 1 && game.resources.credits >= 200,
                data1: game.facilities.dataCenters >= 1 && game.resources.credits >= 300,
                quant1: game.facilities.quantumComputers >= 1 && game.resources.credits >= 500,
                firewall1: game.facilities.firewalls >= 1 && game.resources.data >= 400
            };
            return requirements[upgrade] && !game.upgrades[upgrade];
        }

        // 购买升级
        function buyUpgrade(upgrade) {
            if (!canBuyUpgrade(upgrade)) return;
            
            const costs = {
                gen1: { credits: 200 },
                data1: { credits: 300 },
                quant1: { credits: 500 },
                firewall1: { data: 400 }
            };
            
            if (costs[upgrade].credits) game.resources.credits -= costs[upgrade].credits;
            if (costs[upgrade].data) game.resources.data -= costs[upgrade].data;
            
            game.upgrades[upgrade] = true;
            
            // 应用升级效果
            switch(upgrade) {
                case 'gen1':
                    addLog("能源发生器升级完成 - 能源产出增加");
                    break;
                case 'data1':
                    addLog("数据中心升级完成 - 数据处理能力提升");
                    break;
                case 'quant1':
                    addLog("量子优化完成 - 算力效率提高");
                    break;
                case 'firewall1':
                    addLog("高级防火墙已部署 - 系统安全性提升");
                    break;
            }
            
            updateUI();
            saveGame();
        }

        // 更新成就
        function updateAchievements() {
            const achievements = ['start', 'hack', 'overload', 'quantum', 'singularity'];
            achievements.forEach(achieve => {
                const element = document.getElementById(`achieve-${achieve}`);
                if (game.achievements[achieve]) {
                    element.classList.add('unlocked');
                }
            });
        }

        // 解锁成就
        function unlockAchievement(achieve) {
            if (!game.achievements[achieve]) {
                game.achievements[achieve] = true;
                addLog(`成就解锁: ${getAchievementName(achieve)}`);
                updateUI();
                saveGame();
            }
        }

        // 获取成就名称
        function getAchievementName(achieve) {
            const names = {
                start: "初次启动",
                hack: "防火墙测试",
                overload: "冷静应对",
                quantum: "量子跃迁",
                singularity: "奇点临近"
            };
            return names[achieve];
        }

        // 添加日志
        function addLog(message) {
            const log = document.getElementById('log');
            const entry = document.createElement('p');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // 切换标签页
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`.tab[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById(`${tab}-tab`).classList.add('active');
        }

        // 购买设施
        function buyGenerator() {
            if (game.resources.credits >= 50) {
                game.resources.credits -= 50;
                game.facilities.generators++;
                game.rates.energy += 0.5;
                if (game.upgrades.gen1) game.rates.energy += 0.25;
                addLog("能源发生器建造完成");
                if (game.facilities.generators === 1) unlockAchievement('start');
                updateUI();
                saveGame();
            } else {
                addLog("错误: 信用点不足");
            }
        }

        function buyDataCenter() {
            if (game.resources.credits >= 100) {
                game.resources.credits -= 100;
                game.facilities.dataCenters++;
                game.rates.data += 0.3;
                if (game.upgrades.data1) game.rates.data += 0.15;
                addLog("数据中心建造完成");
                updateUI();
                saveGame();
            } else {
                addLog("错误: 信用点不足");
            }
        }

        function buyQuantumComputer() {
            if (game.resources.credits >= 500) {
                game.resources.credits -= 500;
                game.facilities.quantumComputers++;
                game.resources.maxCompute += 50;
                if (game.upgrades.quant1) game.resources.maxCompute += 25;
                addLog("量子计算机上线");
                updateUI();
                saveGame();
            } else {
                addLog("错误: 信用点不足");
            }
        }

        function buyFirewall() {
            if (game.resources.data >= 200) {
                game.resources.data -= 200;
                game.facilities.firewalls++;
                addLog("防火墙升级完成");
                if (game.upgrades.firewall1) game.stability += 10;
                updateUI();
                saveGame();
            } else {
                addLog("错误: 数据碎片不足");
            }
        }

        // 玩家行动
        function harvestEnergy() {
            const amount = 5 + (game.tech.neural ? 3 : 0);
            game.resources.energy += amount;
            addLog(`收集了 ${amount} 单位能源`);
            updateUI();
            saveGame();
        }

        function mineData() {
            const amount = 3 + (game.tech.neural ? 2 : 0);
            game.resources.data += amount;
            addLog(`挖掘了 ${amount} 数据碎片`);
            updateUI();
            saveGame();
        }

        function runComputation() {
            if (game.resources.compute < game.resources.maxCompute) {
                const amount = 10 + (game.tech.quantum ? 5 : 0);
                game.resources.compute = Math.min(game.resources.compute + amount, game.resources.maxCompute);
                addLog(`执行了计算任务 (+${amount} 算力)`);
                updateUI();
                saveGame();
            } else {
                addLog("错误: 算力已达上限");
            }
        }

        function sellData() {
            if (game.resources.data >= 10) {
                const amount = Math.floor(game.resources.data / 10);
                game.resources.data -= amount * 10;
                game.resources.credits += amount;
                addLog(`出售了 ${amount * 10} 数据碎片，获得 ${amount} 信用点`);
                updateUI();
                saveGame();
            } else {
                addLog("错误: 数据碎片不足 (需要至少10)");
            }
        }

        function buyCredits() {
            if (!game.tech.darkweb) {
                addLog("错误: 需要先研究暗网接入技术");
                return;
            }
            
            // 高风险交易
            const success = Math.random() > 0.3;
            if (success) {
                const amount = 50 + Math.floor(Math.random() * 100);
                game.resources.credits += amount;
                addLog(`黑市交易成功! 获得 ${amount} 信用点`);
            } else {
                // 交易失败惩罚
                const lost = Math.min(50, game.resources.credits);
                game.resources.credits -= lost;
                game.stability -= 10;
                addLog(`黑市交易失败! 损失 ${lost} 信用点，系统稳定性下降`);
                checkStability();
            }
            updateUI();
            saveGame();
        }

        // 事件系统
        function triggerHackEvent() {
            if (game.hackActive || game.gameOver) return;
            
            // 防火墙减少黑客几率
            const hackChance = 0.01 * (1 - (game.facilities.firewalls * 0.1));
            if (Math.random() < hackChance) {
                game.hackActive = true;
                game.hackTime = 10;
                
                // 生成随机代码
                const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
                let code = '';
                for (let i = 0; i < 6; i++) {
                    code += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                document.getElementById('hack-code').textContent = code;
                document.getElementById('hack-input').value = '';
                
                // 显示事件面板
                document.getElementById('hack-event').style.display = 'block';
                
                // 开始倒计时
                const hackInterval = setInterval(() => {
                    game.hackTime--;
                    document.getElementById('hack-timer').textContent = `剩余时间: ${game.hackTime}秒`;
                    
                    if (game.hackTime <= 0) {
                        clearInterval(hackInterval);
                        resolveHack(false);
                    }
                }, 1000);
            }
        }

        function resolveHack(success) {
            game.hackActive = false;
            document.getElementById('hack-event').style.display = 'none';
            
            if (success) {
                const input = document.getElementById('hack-input').value.toUpperCase();
                const code = document.getElementById('hack-code').textContent;
                
                if (input === code) {
                    addLog("黑客攻击已成功抵御!");
                    game.resources.research += 5;
                    unlockAchievement('hack');
                } else {
                    addLog("验证失败! 部分数据丢失");
                    game.resources.data = Math.max(0, game.resources.data - 20);
                }
            } else {
                addLog("黑客攻击成功! 系统受损");
                game.resources.energy = Math.max(0, game.resources.energy - 30);
                game.stability -= 15;
                checkStability();
            }
            
            updateUI();
            saveGame();
        }

        function triggerOverloadEvent() {
            if (game.overloadActive || game.gameOver) return;
            
            // 高算力使用时更易过载
            const overloadChance = (game.resources.compute / game.resources.maxCompute) * 0.02;
            if (Math.random() < overloadChance) {
                game.overloadActive = true;
                game.overloadTime = 10;
                
                // 显示事件面板
                document.getElementById('overload-event').style.display = 'block';
                
                // 开始过载动画
                let overload = 0;
                const overloadInterval = setInterval(() => {
                    overload = (overload + 10 + Math.random() * 20) % 100;
                    document.getElementById('overload-bar').style.width = `${overload}%`;
                    
                    game.overloadTime--;
                    document.getElementById('overload-timer').textContent = `倒计时: ${game.overloadTime}秒`;
                    
                    if (game.overloadTime <= 0) {
                        clearInterval(overloadInterval);
                        resolveOverload(false);
                    }
                }, 1000);
            }
        }

        function coolSystem() {
            if (game.overloadActive) {
                game.overloadActive = false;
                document.getElementById('overload-event').style.display = 'none';
                addLog("紧急降温成功! 系统恢复稳定");
                game.resources.compute = Math.max(0, game.resources.compute - 20);
                unlockAchievement('overload');
                updateUI();
                saveGame();
            }
        }

        function resolveOverload(success) {
            game.overloadActive = false;
            document.getElementById('overload-event').style.display = 'none';
            
            if (!success) {
                addLog("系统过载崩溃!");
                game.stability -= 30;
                game.resources.compute = 0;
                checkStability();
                updateUI();
                saveGame();
            }
        }

        // 检查系统稳定性
        function checkStability() {
            if (game.stability <= 0) {
                game.gameOver = true;
                addLog("致命错误: 系统完全崩溃!");
                document.getElementById('game-over').style.display = 'block';
            }
        }

        // 游戏主循环
        function gameLoop() {
            const now = Date.now();
            const delta = (now - game.lastUpdate) / 1000; // 转换为秒
            game.lastUpdate = now;
            
            if (game.gameOver) return;
            
            // 资源生产
            if (game.facilities.generators > 0) {
                game.resources.energy += game.rates.energy * delta;
            }
            
            if (game.facilities.dataCenters > 0) {
                game.resources.data += game.rates.data * delta;
            }
            
            // 自动化
            if (game.tech.ai) {
                // 自动分配能源
                if (document.getElementById('auto-energy').checked && game.resources.energy > 20) {
                    game.resources.energy -= 20 * delta;
                    game.resources.compute = Math.min(game.resources.compute + 5 * delta, game.resources.maxCompute);
                }
                
                // 自动分析数据
                if (document.getElementById('auto-data').checked && game.resources.data > 10) {
                    game.resources.data -= 10 * delta;
                    game.resources.research += 0.5 * delta;
                }
            }
            
            // 随机事件
            triggerHackEvent();
            triggerOverloadEvent();
            
            updateUI();
            saveGame();
            
            requestAnimationFrame(gameLoop);
        }

        // 初始化游戏
        window.onload = function() {
            loadGame();
            gameLoop();
            
            // 设置自动保存
            setInterval(saveGame, 30000); // 每30秒自动保存
            
            // 绑定黑客输入事件
            document.getElementById('hack-input').addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    resolveHack(true);
                }
            });
        };
    </script>
</body>
</html>
