<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çŸ¿å·¥å¤§å†’é™©ç»ˆæç‰ˆ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background-color: #1a1a2e;
            color: #e6e6e6;
            overflow-x: hidden;
            touch-action: manipulation;
        }
        
        #game-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 10px;
        }
        
        header {
            text-align: center;
            padding: 10px 0;
            border-bottom: 2px solid #4e4e6d;
            margin-bottom: 15px;
        }
        
        h1 {
            color: #f8bb22;
            font-size: 24px;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 10px;
            border-bottom: 1px solid #4e4e6d;
            overflow-x: auto;
        }
        
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            background-color: #2a2a3a;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab.active {
            background-color: #4e4e6d;
            color: #f8bb22;
        }
        
        .panel {
            display: none;
            padding: 15px;
            background-color: #2a2a3a;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .panel.active {
            display: block;
        }
        
        .resource-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #16213e;
            border-radius: 5px;
            flex-wrap: wrap;
        }
        
        .resource {
            text-align: center;
            min-width: 80px;
            margin: 5px 0;
        }
        
        .resource-value {
            font-size: 18px;
            font-weight: bold;
            color: #f8bb22;
        }
        
        .button {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background-color: #4e4e6d;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .button:hover {
            background-color: #6e6e8d;
        }
        
        .button:active {
            transform: scale(0.98);
        }
        
        .button.upgrade {
            background-color: #1e8449;
        }
        
        .button.upgrade:hover {
            background-color: #27ae60;
        }
        
        .button.special {
            background-color: #8e44ad;
        }
        
        .button.special:hover {
            background-color: #9b59b6;
        }
        
        .button.danger {
            background-color: #c0392b;
        }
        
        .button.danger:hover {
            background-color: #e74c3c;
        }
        
        .progress-container {
            width: 100%;
            background-color: #4e4e6d;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #f8bb22;
            border-radius: 5px;
            width: 0%;
            transition: width 0.5s;
        }
        
        .upgrade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: #16213e;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        
        .upgrade-info {
            flex: 1;
        }
        
        .upgrade-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .upgrade-description {
            font-size: 12px;
            color: #a0a0a0;
        }
        
        .upgrade-cost {
            text-align: right;
            min-width: 80px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(46, 204, 113, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 100;
            animation: fadeInOut 3s forwards;
            display: none;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; top: 10px; }
            20% { opacity: 1; top: 20px; }
            80% { opacity: 1; top: 20px; }
            100% { opacity: 0; top: 10px; }
        }
        
        .event-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #2a2a3a;
            padding: 20px;
            border-radius: 10px;
            z-index: 200;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            display: none;
        }
        
        .event-title {
            color: #f8bb22;
            margin-bottom: 15px;
            text-align: center;
            font-size: 20px;
        }
        
        .event-content {
            margin-bottom: 20px;
        }
        
        .event-actions {
            display: flex;
            justify-content: space-between;
        }
        
        .event-button {
            padding: 10px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }
        
        .event-button.primary {
            background-color: #27ae60;
            color: white;
        }
        
        .event-button.secondary {
            background-color: #e74c3c;
            color: white;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* æ–°å¢æ ·å¼ */
        .market-trend {
            padding: 5px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .trend-up {
            background-color: rgba(46, 204, 113, 0.3);
            color: #2ecc71;
        }
        
        .trend-down {
            background-color: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }
        
        .trend-neutral {
            background-color: rgba(241, 196, 15, 0.3);
            color: #f1c40f;
        }
        
        .achievement {
            padding: 10px;
            margin-bottom: 10px;
            background-color: #16213e;
            border-radius: 5px;
            border-left: 4px solid #f8bb22;
        }
        
        .achievement.unlocked {
            border-left-color: #27ae60;
        }
        
        .achievement-progress {
            height: 5px;
            background-color: #4e4e6d;
            border-radius: 3px;
            margin-top: 5px;
        }
        
        .achievement-progress-bar {
            height: 100%;
            background-color: #f8bb22;
            border-radius: 3px;
            width: 0%;
        }
        
        .task-item {
            padding: 10px;
            margin-bottom: 10px;
            background-color: #16213e;
            border-radius: 5px;
        }
        
        .task-reward {
            color: #f8bb22;
            font-weight: bold;
        }
        
        .inventory-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #16213e;
            border-radius: 5px;
        }
        
        .pet-card {
            padding: 10px;
            margin-bottom: 10px;
            background-color: #16213e;
            border-radius: 5px;
            text-align: center;
        }
        
        .pet-image {
            width: 80px;
            height: 80px;
            background-color: #4e4e6d;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }
        
        .pet-skill {
            display: inline-block;
            padding: 3px 6px;
            background-color: #8e44ad;
            border-radius: 3px;
            margin: 3px;
            font-size: 12px;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 400px) {
            .resource {
                font-size: 12px;
            }
            .resource-value {
                font-size: 14px;
            }
            .button {
                padding: 10px;
                font-size: 14px;
            }
            .tab-container {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <header>
            <h1>çŸ¿å·¥å¤§å†’é™©ç»ˆæç‰ˆ</h1>
            <div id="player-level">ç­‰çº§: 1</div>
            <div id="player-prestige">è½¬ç”Ÿ: 0</div>
        </header>
        
        <div class="resource-display">
            <div class="resource">
                <div>é‡‘å¸</div>
                <div class="resource-value" id="gold">0</div>
            </div>
            <div class="resource">
                <div>çŸ¿çŸ³</div>
                <div class="resource-value" id="ore">0</div>
            </div>
            <div class="resource">
                <div>é’»çŸ³</div>
                <div class="resource-value" id="diamond">0</div>
            </div>
            <div class="resource">
                <div>å£°æœ›</div>
                <div class="resource-value" id="reputation">0</div>
            </div>
            <div class="resource">
                <div>èƒ½é‡</div>
                <div class="resource-value" id="energy">100</div>
            </div>
            <div class="resource">
                <div>å®çŸ³</div>
                <div class="resource-value" id="gem">0</div>
            </div>
        </div>
        
        <div class="tab-container">
            <div class="tab active" data-tab="mining">æŒ–çŸ¿</div>
            <div class="tab" data-tab="upgrades">å‡çº§</div>
            <div class="tab" data-tab="market">å¸‚åœº</div>
            <div class="tab" data-tab="achievements">æˆå°±</div>
            <div class="tab" data-tab="tasks">ä»»åŠ¡</div>
            <div class="tab" data-tab="inventory">èƒŒåŒ…</div>
            <div class="tab" data-tab="pets">å® ç‰©</div>
            <div class="tab" data-tab="guild">å·¥ä¼š</div>
            <div class="tab" data-tab="research">ç ”ç©¶</div>
            <div class="tab" data-tab="prestige">è½¬ç”Ÿ</div>
        </div>
        
        <!-- æŒ–çŸ¿é¢æ¿ -->
        <div class="panel active" id="mining-panel">
            <div class="progress-container">
                <div class="progress-bar" id="mining-progress"></div>
            </div>
            <button class="button" id="mine-button">æŒ–çŸ¿</button>
            <button class="button special" id="deep-mine-button">æ·±åº¦æŒ–æ˜ (æ¶ˆè€—10ä½“åŠ›)</button>
            <button class="button danger" id="blasting-button">çˆ†ç ´å¼€é‡‡ (æ¶ˆè€—50èƒ½é‡)</button>
            
            <h3>çŸ¿å·¥çŠ¶æ€</h3>
            <div>ä½“åŠ›: <span id="stamina">100</span>/<span id="max-stamina">100</span></div>
            <div class="progress-container">
                <div class="progress-bar" id="stamina-progress" style="width: 100%;"></div>
            </div>
            <div>èƒ½é‡: <span id="energy-value">100</span>/100</div>
            <div class="progress-container">
                <div class="progress-bar" id="energy-progress" style="width: 100%;"></div>
            </div>
            <div>æŒ–çŸ¿æ•ˆç‡: <span id="mining-efficiency">1</span> çŸ¿çŸ³/ç§’</div>
            <div>ç¨€æœ‰ç‡: <span id="rarity-chance">1</span>%</div>
            <div>æš´å‡»ç‡: <span id="critical-chance">5</span>%</div>
            
            <h3>è‡ªåŠ¨çŸ¿å·¥</h3>
            <div id="auto-miners">è‡ªåŠ¨çŸ¿å·¥: 0</div>
            <button class="button upgrade" id="hire-miner-button">é›‡ä½£çŸ¿å·¥ (100é‡‘å¸)</button>
            
            <h3>å½“å‰çŸ¿æ´</h3>
            <div id="current-mine">åŸºç¡€çŸ¿æ´ (ç­‰çº§1)</div>
            <button class="button" id="explore-mine-button">æ¢ç´¢æ–°çŸ¿æ´ (50èƒ½é‡)</button>
        </div>
        
        <!-- å‡çº§é¢æ¿ -->
        <div class="panel" id="upgrades-panel">
            <h3>å·¥å…·å‡çº§</h3>
            <div class="upgrade-item">
                <div class="upgrade-info">
                    <div class="upgrade-name">æ›´å¥½çš„é•å¤´</div>
                    <div class="upgrade-description">æé«˜æŒ–çŸ¿æ•ˆç‡ +0.5/ç§’</div>
                </div>
                <div class="upgrade-cost">
                    <div>50é‡‘å¸</div>
                    <button class="button upgrade" data-upgrade="pickaxe">å‡çº§</button>
                </div>
            </div>
            
            <div class="upgrade-item">
                <div class="upgrade-info">
                    <div class="upgrade-name">çŸ¿ç¯</div>
                    <div class="upgrade-description">æé«˜ç¨€æœ‰ç‡ +1%</div>
                </div>
                <div class="upgrade-cost">
                    <div>100é‡‘å¸</div>
                    <button class="button upgrade" data-upgrade="lamp">å‡çº§</button>
                </div>
            </div>
            
            <div class="upgrade-item">
                <div class="upgrade-info">
                    <div class="upgrade-name">çŸ¿è½¦</div>
                    <div class="upgrade-description">è§£é”è‡ªåŠ¨è¿è¾“ï¼Œä½“åŠ›æ¢å¤+0.5/ç§’</div>
                </div>
                <div class="upgrade-cost">
                    <div>500é‡‘å¸</div>
                    <button class="button upgrade" data-upgrade="cart">è§£é”</button>
                </div>
            </div>
            
            <div class="upgrade-item">
                <div class="upgrade-info">
                    <div class="upgrade-name">çˆ†ç ´è£…ç½®</div>
                    <div class="upgrade-description">è§£é”çˆ†ç ´å¼€é‡‡ï¼Œæé«˜æš´å‡»ç‡+2%</div>
                </div>
                <div class="upgrade-cost">
                    <div>800é‡‘å¸</div>
                    <button class="button upgrade" data-upgrade="blasting">è§£é”</button>
                </div>
            </div>
            
            <h3>çŸ¿æ´å‡çº§</h3>
            <div class="upgrade-item">
                <div class="upgrade-info">
                    <div class="upgrade-name">é“œçŸ¿æ´</div>
                    <div class="upgrade-description">è§£é”é“œçŸ¿ï¼ŒåŸºç¡€æŒ–çŸ¿å¥–åŠ±+10%</div>
                </div>
                <div class="upgrade-cost">
                    <div>ç­‰çº§ 2</div>
                    <button class="button upgrade" data-upgrade="copper-mine" disabled>è§£é”</button>
                </div>
            </div>
            
            <div class="upgrade-item">
                <div class="upgrade-info">
                    <div class="upgrade-name">é“çŸ¿æ´</div>
                    <div class="upgrade-description">è§£é”é“çŸ¿ï¼Œç¨€æœ‰ç‡+5%</div>
                </div>
                <div class="upgrade-cost">
                    <div>ç­‰çº§ 5</div>
                    <button class="button upgrade" data-upgrade="iron-mine" disabled>è§£é”</button>
                </div>
            </div>
        </div>
        
        <!-- å¸‚åœºé¢æ¿ -->
        <div class="panel" id="market-panel">
            <h3>çŸ¿çŸ³å¸‚åœº</h3>
            <div>å½“å‰çŸ¿çŸ³ä»·æ ¼: <span id="ore-price">10</span> é‡‘å¸/çŸ¿çŸ³ 
                <span id="ore-trend" class="market-trend trend-neutral">â†’</span>
            </div>
            <div>å½“å‰é’»çŸ³ä»·æ ¼: <span id="diamond-price">100</span> é‡‘å¸/é’»çŸ³ 
                <span id="diamond-trend" class="market-trend trend-neutral">â†’</span>
            </div>
            <div>å¸‚åœºæ³¢åŠ¨: <span id="market-volatility">ä½</span></div>
            
            <h3>å‡ºå”®çŸ¿çŸ³</h3>
            <button class="button" id="sell-ore-button">å‡ºå”®çŸ¿çŸ³ (10%)</button>
            <button class="button" id="sell-all-ore-button">å‡ºå”®æ‰€æœ‰çŸ¿çŸ³</button>
            
            <h3>å‡ºå”®é’»çŸ³</h3>
            <button class="button special" id="sell-diamond-button">å‡ºå”®é’»çŸ³ (10%)</button>
            <button class="button special" id="sell-all-diamond-button">å‡ºå”®æ‰€æœ‰é’»çŸ³</button>
            
            <h3>è‡ªåŠ¨å‡ºå”®è®¾ç½®</h3>
            <div>çŸ¿çŸ³é˜ˆå€¼: <span id="ore-threshold">0</span></div>
            <button class="button" id="increase-ore-threshold">+100</button>
            <button class="button" id="decrease-ore-threshold">-100</button>
            
            <div>é’»çŸ³é˜ˆå€¼: <span id="diamond-threshold">0</span></div>
            <button class="button" id="increase-diamond-threshold">+10</button>
            <button class="button" id="decrease-diamond-threshold">-10</button>
        </div>
        
        <!-- æˆå°±é¢æ¿ -->
        <div class="panel" id="achievements-panel">
            <h3>æˆå°±ç³»ç»Ÿ</h3>
            <div>å·²å®Œæˆæˆå°±: <span id="achievements-completed">0</span>/50</div>
            <div>æˆå°±ç‚¹æ•°: <span id="achievement-points">0</span></div>
            
            <h3>æŒ–çŸ¿æˆå°±</h3>
            <div id="mining-achievements">
                <div class="achievement">
                    <div class="upgrade-name">åˆå‡ºèŒ…åº</div>
                    <div class="upgrade-description">æŒ–åˆ°100çŸ¿çŸ³</div>
                    <div class="achievement-progress">
                        <div class="achievement-progress-bar" style="width: 0%;"></div>
                    </div>
                </div>
                <!-- æ›´å¤šæˆå°±ä¼šåœ¨JSä¸­åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- ä»»åŠ¡é¢æ¿ -->
        <div class="panel" id="tasks-panel">
            <h3>æ¯æ—¥ä»»åŠ¡</h3>
            <div id="daily-tasks">
                <div class="task-item">
                    <div class="upgrade-name">æŒ–çŸ¿æ–°æ‰‹</div>
                    <div class="upgrade-description">æŒ–çŸ¿50æ¬¡</div>
                    <div class="task-reward">å¥–åŠ±: 100é‡‘å¸</div>
                    <div class="achievement-progress">
                        <div class="achievement-progress-bar" style="width: 0%;"></div>
                    </div>
                </div>
                <!-- æ›´å¤šä»»åŠ¡ä¼šåœ¨JSä¸­åŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <h3>ä¸»çº¿ä»»åŠ¡</h3>
            <div id="main-tasks">
                <div class="task-item">
                    <div class="upgrade-name">ç¬¬ä¸€æ¡¶é‡‘</div>
                    <div class="upgrade-description">ç§¯ç´¯1000é‡‘å¸</div>
                    <div class="task-reward">å¥–åŠ±: è§£é”æ–°çŸ¿æ´</div>
                    <div class="achievement-progress">
                        <div class="achievement-progress-bar" style="width: 0%;"></div>
                    </div>
                </div>
                <!-- æ›´å¤šä»»åŠ¡ä¼šåœ¨JSä¸­åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- èƒŒåŒ…é¢æ¿ -->
        <div class="panel" id="inventory-panel">
            <h3>è£…å¤‡</h3>
            <div id="equipment">
                <div class="inventory-item">
                    <div>é•å¤´: <span id="pickaxe-equip">åŸºç¡€é•</span></div>
                    <button class="button upgrade" id="upgrade-pickaxe-button">å‡çº§</button>
                </div>
                <div class="inventory-item">
                    <div>çŸ¿ç¯: <span id="lamp-equip">åŸºç¡€ç¯</span></div>
                    <button class="button upgrade" id="upgrade-lamp-button">å‡çº§</button>
                </div>
            </div>
            
            <h3>æ¶ˆè€—å“</h3>
            <div id="consumables">
                <div class="inventory-item">
                    <div>ä½“åŠ›è¯å‰‚: <span id="stamina-potion">0</span></div>
                    <button class="button" id="use-stamina-potion">ä½¿ç”¨</button>
                </div>
                <div class="inventory-item">
                    <div>èƒ½é‡é¥®æ–™: <span id="energy-drink">0</span></div>
                    <button class="button" id="use-energy-drink">ä½¿ç”¨</button>
                </div>
            </div>
            
            <h3>å…¶ä»–ç‰©å“</h3>
            <div id="other-items">
                <!-- ç‰©å“ä¼šåœ¨JSä¸­åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- å® ç‰©é¢æ¿ -->
        <div class="panel" id="pets-panel">
            <h3>æˆ‘çš„å® ç‰©</h3>
            <div id="my-pets">
                <div class="pet-card">
                    <div class="pet-image">?</div>
                    <div>æš‚æ— å® ç‰©</div>
                </div>
            </div>
            
            <h3>å® ç‰©å•†åº—</h3>
            <div id="pet-shop">
                <div class="pet-card">
                    <div class="pet-image">ğŸ­</div>
                    <div>çŸ¿é¼ </div>
                    <div>ä»·æ ¼: 500é‡‘å¸</div>
                    <div class="upgrade-description">æé«˜æŒ–çŸ¿æ•ˆç‡+0.2/ç§’</div>
                    <button class="button" data-pet="mouse">è´­ä¹°</button>
                </div>
                <!-- æ›´å¤šå® ç‰©ä¼šåœ¨JSä¸­åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- å·¥ä¼šé¢æ¿ -->
        <div class="panel" id="guild-panel">
            <h3>æˆ‘çš„å·¥ä¼š</h3>
            <div id="my-guild">
                <div>æ‚¨å°šæœªåŠ å…¥å·¥ä¼š</div>
                <button class="button" id="create-guild-button">åˆ›å»ºå·¥ä¼š (1000é‡‘å¸)</button>
                <button class="button" id="join-guild-button">åŠ å…¥å·¥ä¼š</button>
            </div>
            
            <h3>å·¥ä¼šæŠ€èƒ½</h3>
            <div id="guild-skills">
                <div class="upgrade-item">
                    <div class="upgrade-info">
                        <div class="upgrade-name">å›¢é˜Ÿåä½œ</div>
                        <div class="upgrade-description">æ‰€æœ‰æˆå‘˜æŒ–çŸ¿æ•ˆç‡+5%</div>
                    </div>
                    <div class="upgrade-cost">
                        <div>500å£°æœ›</div>
                        <button class="button upgrade" data-guild-skill="teamwork">å­¦ä¹ </button>
                    </div>
                </div>
                <!-- æ›´å¤šæŠ€èƒ½ä¼šåœ¨JSä¸­åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- ç ”ç©¶é¢æ¿ -->
        <div class="panel" id="research-panel">
            <h3>ç ”ç©¶å®éªŒå®¤</h3>
            <div>ç ”ç©¶ç‚¹æ•°: <span id="research-points">0</span></div>
            
            <h3>å¯ç”¨ç ”ç©¶</h3>
            <div id="available-research">
                <div class="upgrade-item">
                    <div class="upgrade-info">
                        <div class="upgrade-name">é«˜æ•ˆé‡‡çŸ¿</div>
                        <div class="upgrade-description">æŒ–çŸ¿æ•ˆç‡+10%</div>
                    </div>
                    <div class="upgrade-cost">
                        <div>100ç ”ç©¶ç‚¹</div>
                        <button class="button upgrade" data-research="efficient-mining">ç ”ç©¶</button>
                    </div>
                </div>
                <!-- æ›´å¤šç ”ç©¶ä¼šåœ¨JSä¸­åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- è½¬ç”Ÿé¢æ¿ -->
        <div class="panel" id="prestige-panel">
            <h3>è½¬ç”Ÿç³»ç»Ÿ</h3>
            <div>å½“å‰è½¬ç”Ÿå¯è·å¾—: <span id="prestige-points">0</span> è½¬ç”Ÿç‚¹æ•°</div>
            <div>è½¬ç”ŸåŠ æˆ: <span id="prestige-bonus">0</span>% æ•ˆç‡</div>
            
            <h3>è½¬ç”Ÿå¥–åŠ±</h3>
            <div class="upgrade-item">
                <div class="upgrade-info">
                    <div class="upgrade-name">ç»éªŒä¼ æ‰¿</div>
                    <div class="upgrade-description">ä¿ç•™10%æŒ–çŸ¿æ•ˆç‡</div>
                </div>
                <div class="upgrade-cost">
                    <div>1è½¬ç”Ÿç‚¹</div>
                    <button class="button upgrade" data-prestige="keep-efficiency">è§£é”</button>
                </div>
            </div>
            <!-- æ›´å¤šè½¬ç”Ÿå¥–åŠ±ä¼šåœ¨JSä¸­åŠ¨æ€ç”Ÿæˆ -->
            
            <button class="button danger" id="prestige-button">è½¬ç”Ÿ</button>
            <div class="upgrade-description">è½¬ç”Ÿå°†é‡ç½®æ‚¨çš„è¿›åº¦ï¼Œä½†ä¼šè·å¾—æ°¸ä¹…åŠ æˆ</div>
        </div>
        
        <div id="notification" class="notification"></div>
        
        <div id="event-popup" class="event-popup">
            <div class="event-title">ç‰¹æ®Šäº‹ä»¶</div>
            <div class="event-content" id="event-content"></div>
            <div class="event-actions">
                <button class="event-button primary" id="event-accept">æ¥å—</button>
                <button class="event-button secondary" id="event-decline">æ‹’ç»</button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            // åŸºç¡€èµ„æº
            gold: 0,
            ore: 0,
            diamond: 0,
            reputation: 0,
            energy: 100,
            gem: 0,
            
            // çŸ¿å·¥çŠ¶æ€
            stamina: 100,
            maxStamina: 100,
            miningEfficiency: 1,
            rarityChance: 1,
            criticalChance: 5,
            autoMiners: 0,
            minerCost: 100,
            currentMine: 0,
            minesUnlocked: 1,
            
            // å¸‚åœº
            orePrice: 10,
            diamondPrice: 100,
            orePriceHistory: [10],
            diamondPriceHistory: [100],
            oreThreshold: 0,
            diamondThreshold: 0,
            marketVolatility: 0,
            
            // æˆå°±ç³»ç»Ÿ
            achievements: {
                mining: {
                    'beginner': { name: 'åˆå‡ºèŒ…åº', desc: 'æŒ–åˆ°100çŸ¿çŸ³', goal: 100, completed: false, reward: 50 },
                    'expert': { name: 'æŒ–çŸ¿ä¸“å®¶', desc: 'æŒ–åˆ°1000çŸ¿çŸ³', goal: 1000, completed: false, reward: 200 },
                    // æ›´å¤šæˆå°±...
                },
                // å…¶ä»–ç±»åˆ«æˆå°±...
            },
            achievementPoints: 0,
            
            // ä»»åŠ¡ç³»ç»Ÿ
            dailyTasks: {
                'mining-1': { name: 'æŒ–çŸ¿æ–°æ‰‹', desc: 'æŒ–çŸ¿50æ¬¡', goal: 50, progress: 0, reward: 100, completed: false },
                // æ›´å¤šæ¯æ—¥ä»»åŠ¡...
            },
            mainTasks: {
                'first-gold': { name: 'ç¬¬ä¸€æ¡¶é‡‘', desc: 'ç§¯ç´¯1000é‡‘å¸', goal: 1000, progress: 0, reward: 'unlock-mine', completed: false },
                // æ›´å¤šä¸»çº¿ä»»åŠ¡...
            },
            lastDailyReset: Date.now(),
            
            // èƒŒåŒ…
            equipment: {
                pickaxe: { name: 'åŸºç¡€é•', level: 1, efficiency: 0 },
                lamp: { name: 'åŸºç¡€ç¯', level: 1, rarity: 0 }
            },
            consumables: {
                staminaPotion: 0,
                energyDrink: 0
            },
            items: {},
            
            // å® ç‰©ç³»ç»Ÿ
            pets: [],
            petShop: [
                { id: 'mouse', name: 'çŸ¿é¼ ', price: 500, emoji: 'ğŸ­', bonus: { efficiency: 0.2 } },
                // æ›´å¤šå® ç‰©...
            ],
            
            // å·¥ä¼šç³»ç»Ÿ
            guild: null,
            guildSkills: {
                'teamwork': { name: 'å›¢é˜Ÿåä½œ', desc: 'æ‰€æœ‰æˆå‘˜æŒ–çŸ¿æ•ˆç‡+5%', cost: 500, learned: false }
            },
            
            // ç ”ç©¶ç³»ç»Ÿ
            researchPoints: 0,
            researches: {
                'efficient-mining': { name: 'é«˜æ•ˆé‡‡çŸ¿', desc: 'æŒ–çŸ¿æ•ˆç‡+10%', cost: 100, researched: false }
            },
            
            // è½¬ç”Ÿç³»ç»Ÿ
            prestige: 0,
            prestigePoints: 0,
            prestigeBonuses: {
                'keep-efficiency': { name: 'ç»éªŒä¼ æ‰¿', desc: 'ä¿ç•™10%æŒ–çŸ¿æ•ˆç‡', cost: 1, purchased: false, bonus: 0.1 }
            },
            
            // å…¶ä»–
            upgrades: {
                pickaxe: 0,
                lamp: 0,
                cart: false,
                blasting: false,
                copperMine: false,
                ironMine: false
            },
            lastPlayed: Date.now(),
            playerLevel: 1,
            experience: 0,
            nextLevelExp: 100,
            version: '1.0.0'
        };

        // DOMå…ƒç´ 
        const elements = {
            // åŸºç¡€èµ„æº
            gold: document.getElementById('gold'),
            ore: document.getElementById('ore'),
            diamond: document.getElementById('diamond'),
            reputation: document.getElementById('reputation'),
            energy: document.getElementById('energy'),
            gem: document.getElementById('gem'),
            
            // çŸ¿å·¥çŠ¶æ€
            stamina: document.getElementById('stamina'),
            maxStamina: document.getElementById('max-stamina'),
            staminaProgress: document.getElementById('stamina-progress'),
            energyValue: document.getElementById('energy-value'),
            energyProgress: document.getElementById('energy-progress'),
            miningEfficiency: document.getElementById('mining-efficiency'),
            rarityChance: document.getElementById('rarity-chance'),
            criticalChance: document.getElementById('critical-chance'),
            mineButton: document.getElementById('mine-button'),
            deepMineButton: document.getElementById('deep-mine-button'),
            blastingButton: document.getElementById('blasting-button'),
            autoMiners: document.getElementById('auto-miners'),
            hireMinerButton: document.getElementById('hire-miner-button'),
            miningProgress: document.getElementById('mining-progress'),
            currentMine: document.getElementById('current-mine'),
            exploreMineButton: document.getElementById('explore-mine-button'),
            
            // å¸‚åœº
            orePrice: document.getElementById('ore-price'),
            diamondPrice: document.getElementById('diamond-price'),
            oreTrend: document.getElementById('ore-trend'),
            diamondTrend: document.getElementById('diamond-trend'),
            marketVolatility: document.getElementById('market-volatility'),
            sellOreButton: document.getElementById('sell-ore-button'),
            sellAllOreButton: document.getElementById('sell-all-ore-button'),
            sellDiamondButton: document.getElementById('sell-diamond-button'),
            sellAllDiamondButton: document.getElementById('sell-all-diamond-button'),
            oreThreshold: document.getElementById('ore-threshold'),
            diamondThreshold: document.getElementById('diamond-threshold'),
            increaseOreThreshold: document.getElementById('increase-ore-threshold'),
            decreaseOreThreshold: document.getElementById('decrease-ore-threshold'),
            increaseDiamondThreshold: document.getElementById('increase-diamond-threshold'),
            decreaseDiamondThreshold: document.getElementById('decrease-diamond-threshold'),
            
            // æˆå°±ç³»ç»Ÿ
            achievementsCompleted: document.getElementById('achievements-completed'),
            achievementPoints: document.getElementById('achievement-points'),
            miningAchievements: document.getElementById('mining-achievements'),
            
            // ä»»åŠ¡ç³»ç»Ÿ
            dailyTasks: document.getElementById('daily-tasks'),
            mainTasks: document.getElementById('main-tasks'),
            
            // èƒŒåŒ…
            pickaxeEquip: document.getElementById('pickaxe-equip'),
            lampEquip: document.getElementById('lamp-equip'),
            upgradePickaxeButton: document.getElementById('upgrade-pickaxe-button'),
            upgradeLampButton: document.getElementById('upgrade-lamp-button'),
            staminaPotion: document.getElementById('stamina-potion'),
            energyDrink: document.getElementById('energy-drink'),
            useStaminaPotion: document.getElementById('use-stamina-potion'),
            useEnergyDrink: document.getElementById('use-energy-drink'),
            otherItems: document.getElementById('other-items'),
            
            // å® ç‰©ç³»ç»Ÿ
            myPets: document.getElementById('my-pets'),
            petShop: document.getElementById('pet-shop'),
            
            // å·¥ä¼šç³»ç»Ÿ
            myGuild: document.getElementById('my-guild'),
            createGuildButton: document.getElementById('create-guild-button'),
            joinGuildButton: document.getElementById('join-guild-button'),
            guildSkills: document.getElementById('guild-skills'),
            
            // ç ”ç©¶ç³»ç»Ÿ
            researchPoints: document.getElementById('research-points'),
            availableResearch: document.getElementById('available-research'),
            
            // è½¬ç”Ÿç³»ç»Ÿ
            prestigePoints: document.getElementById('prestige-points'),
            prestigeBonus: document.getElementById('prestige-bonus'),
            prestigeButton: document.getElementById('prestige-button'),
            
            // å…¶ä»–
            playerLevel: document.getElementById('player-level'),
            notification: document.getElementById('notification'),
            eventPopup: document.getElementById('event-popup'),
            eventContent: document.getElementById('event-content'),
            eventAccept: document.getElementById('event-accept'),
            eventDecline: document.getElementById('event-decline')
        };

        // æ¸¸æˆå˜é‡
        let miningInterval;
        let staminaInterval;
        let autoMiningInterval;
        let marketInterval;
        let isMining = false;
        let miningProgress = 0;
        let eventTimeout;
        let offlineProgressCalculated = false;
        let mineNames = ['åŸºç¡€çŸ¿æ´', 'é“œçŸ¿æ´', 'é“çŸ¿æ´', 'é‡‘çŸ¿æ´', 'æ°´æ™¶çŸ¿æ´'];
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            loadGame();
            setupEventListeners();
            updateUI();
            startGameLoops();
            
            // è®¡ç®—ç¦»çº¿è¿›åº¦
            if (!offlineProgressCalculated) {
                calculateOfflineProgress();
                offlineProgressCalculated = true;
            }
            
            // æ£€æŸ¥æ¯æ—¥ä»»åŠ¡é‡ç½®
            checkDailyReset();
        }

        // åŠ è½½æ¸¸æˆ
        function loadGame() {
            const savedGame = localStorage.getItem('minerAdventureSave');
            if (savedGame) {
                try {
                    const parsed = JSON.parse(savedGame);
                    
                    // ç‰ˆæœ¬æ£€æŸ¥
                    if (parsed.version === gameState.version) {
                        Object.assign(gameState, parsed);
                        
                        // è®¡ç®—ç¦»çº¿æ—¶é—´
                        const now = Date.now();
                        const offlineTime = now - gameState.lastPlayed;
                        
                        if (offlineTime > 10000) { // è‡³å°‘ç¦»çº¿10ç§’æ‰è®¡ç®—
                            const offlineSeconds = Math.floor(offlineTime / 1000);
                            
                            // è®¡ç®—è‡ªåŠ¨æŒ–çŸ¿æ”¶ç›Š
                            if (gameState.autoMiners > 0) {
                                const autoMined = gameState.autoMiners * gameState.miningEfficiency * offlineSeconds;
                                gameState.ore += autoMined;
                                addExperience(autoMined / 10);
                                
                                // éšæœºé’»çŸ³
                                for (let i = 0; i < autoMined; i++) {
                                    if (Math.random() * 100 < gameState.rarityChance) {
                                        gameState.diamond++;
                                    }
                                }
                            }
                            
                            // è®¡ç®—ä½“åŠ›æ¢å¤
                            if (gameState.upgrades.cart) {
                                const staminaRecovered = offlineSeconds * 0.5;
                                gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + staminaRecovered);
                            }
                            
                            // è®¡ç®—èƒ½é‡æ¢å¤
                            const energyRecovered = offlineSeconds * 0.2;
                            gameState.energy = Math.min(100, gameState.energy + energyRecovered);
                            
                            // è®¡ç®—é“¶è¡Œåˆ©æ¯
                            if (gameState.bankBalance > 0) {
                                const daysOffline = offlineTime / (1000 * 60 * 60 * 24);
                                const interest = gameState.bankBalance * (gameState.interestRate / 100) * daysOffline;
                                gameState.bankBalance += interest;
                            }
                            
                            showNotification(`æ‚¨ç¦»çº¿äº† ${formatTime(offlineTime)}ï¼Œè‡ªåŠ¨æŒ–çŸ¿è·å¾— ${Math.floor(autoMined)} çŸ¿çŸ³`);
                        }
                        
                        gameState.lastPlayed = now;
                        saveGame();
                    } else {
                        showNotification("æ¸¸æˆå·²æ›´æ–°ï¼Œéƒ¨åˆ†æ•°æ®éœ€è¦é‡ç½®");
                    }
                } catch (e) {
                    console.error("åŠ è½½å­˜æ¡£å¤±è´¥:", e);
                    showNotification("åŠ è½½å­˜æ¡£å¤±è´¥ï¼Œå¼€å§‹æ–°æ¸¸æˆ");
                }
            }
            
            // åˆå§‹åŒ–æˆå°±ç³»ç»Ÿ
            initAchievements();
            
            // åˆå§‹åŒ–ä»»åŠ¡ç³»ç»Ÿ
            initTasks();
        }

        // ä¿å­˜æ¸¸æˆ
        function saveGame() {
            gameState.lastPlayed = Date.now();
            try {
                localStorage.setItem('minerAdventureSave', JSON.stringify(gameState));
            } catch (e) {
                console.error("ä¿å­˜æ¸¸æˆå¤±è´¥:", e);
            }
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æ ‡ç­¾åˆ‡æ¢
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-panel`).classList.add('active');
                });
            });
            
            // æŒ–çŸ¿æŒ‰é’®
            elements.mineButton.addEventListener('click', startMining);
            elements.deepMineButton.addEventListener('click', deepMining);
            elements.blastingButton.addEventListener('click', blastingMining);
            
            // é›‡ä½£çŸ¿å·¥
            elements.hireMinerButton.addEventListener('click', hireMiner);
            
            // æ¢ç´¢çŸ¿æ´
            elements.exploreMineButton.addEventListener('click', exploreNewMine);
            
            // å‡çº§æŒ‰é’®
            document.querySelectorAll('[data-upgrade]').forEach(button => {
                button.addEventListener('click', () => {
                    const upgrade = button.dataset.upgrade;
                    buyUpgrade(upgrade);
                });
            });
            
            // å¸‚åœºæŒ‰é’®
            elements.sellOreButton.addEventListener('click', () => sellOre(0.1));
            elements.sellAllOreButton.addEventListener('click', () => sellOre(1));
            elements.sellDiamondButton.addEventListener('click', () => sellDiamond(0.1));
            elements.sellAllDiamondButton.addEventListener('click', () => sellDiamond(1));
            elements.increaseOreThreshold.addEventListener('click', () => changeOreThreshold(100));
            elements.decreaseOreThreshold.addEventListener('click', () => changeOreThreshold(-100));
            elements.increaseDiamondThreshold.addEventListener('click', () => changeDiamondThreshold(10));
            elements.decreaseDiamondThreshold.addEventListener('click', () => changeDiamondThreshold(-10));
            
            // èƒŒåŒ…æŒ‰é’®
            elements.useStaminaPotion.addEventListener('click', useStaminaPotion);
            elements.useEnergyDrink.addEventListener('click', useEnergyDrink);
            
            // å® ç‰©æŒ‰é’®
            document.querySelectorAll('[data-pet]').forEach(button => {
                button.addEventListener('click', () => {
                    const petId = button.dataset.pet;
                    buyPet(petId);
                });
            });
            
            // å·¥ä¼šæŒ‰é’®
            elements.createGuildButton.addEventListener('click', createGuild);
            elements.joinGuildButton.addEventListener('click', joinGuild);
            
            // ç ”ç©¶æŒ‰é’®
            document.querySelectorAll('[data-research]').forEach(button => {
                button.addEventListener('click', () => {
                    const researchId = button.dataset.research;
                    conductResearch(researchId);
                });
            });
            
            // è½¬ç”ŸæŒ‰é’®
            elements.prestigeButton.addEventListener('click', prestige);
            
            // äº‹ä»¶æŒ‰é’®
            elements.eventAccept.addEventListener('click', acceptEvent);
            elements.eventDecline.addEventListener('click', declineEvent);
            
            // çª—å£å…³é—­å‰ä¿å­˜
            window.addEventListener('beforeunload', saveGame);
        }

        // å¼€å§‹æ¸¸æˆå¾ªç¯
        function startGameLoops() {
            // è‡ªåŠ¨æŒ–çŸ¿å¾ªç¯
            if (gameState.autoMiners > 0) {
                startAutoMining();
            }
            
            // ä½“åŠ›æ¢å¤å¾ªç¯
            staminaInterval = setInterval(() => {
                if (gameState.upgrades.cart && gameState.stamina < gameState.maxStamina) {
                    gameState.stamina = Math.min(gameState.maxStamina, gameState.stamina + 0.5);
                    updateStaminaUI();
                }
            }, 1000);
            
            // èƒ½é‡æ¢å¤å¾ªç¯
            setInterval(() => {
                if (gameState.energy < 100) {
                    gameState.energy = Math.min(100, gameState.energy + 0.2);
                    updateEnergyUI();
                }
            }, 1000);
            
            // å¸‚åœºæ³¢åŠ¨å¾ªç¯
            marketInterval = setInterval(updateMarketPrices, 30000);
            
            // éšæœºäº‹ä»¶å¾ªç¯
            eventTimeout = setTimeout(triggerRandomEvent, getRandomTime(120000, 300000));
            
            // è‡ªåŠ¨å‡ºå”®æ£€æŸ¥
            setInterval(checkAutoSell, 10000);
            
            // å®šæœŸä¿å­˜
            setInterval(saveGame, 30000);
        }

        // å¼€å§‹æŒ–çŸ¿
        function startMining() {
            if (isMining) return;
            if (gameState.stamina < 2) {
                showNotification("ä½“åŠ›ä¸è¶³ï¼");
                return;
            }
            
            isMining = true;
            miningProgress = 0;
            elements.miningProgress.style.width = '0%';
            
            miningInterval = setInterval(() => {
                miningProgress += 10;
                elements.miningProgress.style.width = `${miningProgress}%`;
                
                if (miningProgress >= 100) {
                    finishMining();
                }
            }, 500);
        }

        // æ·±åº¦æŒ–æ˜
        function deepMining() {
            if (gameState.stamina < 10) {
                showNotification("ä½“åŠ›ä¸è¶³ï¼");
                return;
            }
            
            gameState.stamina -= 10;
            updateStaminaUI();
            
            let baseGain = 5 + Math.floor(Math.random() * 6);
            
            // çŸ¿æ´åŠ æˆ
            if (gameState.currentMine > 0) {
                baseGain *= 1 + (gameState.currentMine * 0.2);
            }
            
            // æš´å‡»æ£€æŸ¥
            let isCritical = false;
            if (Math.random() * 100 < gameState.criticalChance) {
                baseGain *= 2;
                isCritical = true;
            }
            
            const oreGain = Math.floor(baseGain * gameState.miningEfficiency);
            gameState.ore += oreGain;
            
            // æ›´é«˜å‡ ç‡è·å¾—é’»çŸ³
            let diamondGain = 0;
            if (Math.random() * 100 < gameState.rarityChance * 3) {
                diamondGain = 1;
                gameState.diamond += diamondGain;
            }
            
            // æˆå°±è¿›åº¦
            updateAchievementProgress('mining', 'deep-miner', 1);
            
            if (diamondGain > 0) {
                showNotification(`${isCritical ? 'æš´å‡»ï¼' : ''}æ·±åº¦æŒ–æ˜è·å¾— ${oreGain} çŸ¿çŸ³å’Œ ${diamondGain} é’»çŸ³ï¼`);
            } else {
                showNotification(`${isCritical ? 'æš´å‡»ï¼' : ''}æ·±åº¦æŒ–æ˜è·å¾— ${oreGain} çŸ¿çŸ³ï¼`);
            }
            
            addExperience(oreGain / 5);
            updateResourcesUI();
            saveGame();
        }

        // çˆ†ç ´å¼€é‡‡
        function blastingMining() {
            if (!gameState.upgrades.blasting) {
                showNotification("å°šæœªè§£é”çˆ†ç ´å¼€é‡‡ï¼");
                return;
            }
            
            if (gameState.energy < 50) {
                showNotification("èƒ½é‡ä¸è¶³ï¼");
                return;
            }
            
            gameState.energy -= 50;
            updateEnergyUI();
            
            let baseGain = 20 + Math.floor(Math.random() * 21);
            
            // çŸ¿æ´åŠ æˆ
            if (gameState.currentMine > 0) {
                baseGain *= 1 + (gameState.currentMine * 0.3);
            }
            
            // æš´å‡»æ£€æŸ¥ (çˆ†ç ´å¼€é‡‡æœ‰æ›´é«˜æš´å‡»ç‡)
            let isCritical = false;
            if (Math.random() * 100 < gameState.criticalChance * 1.5) {
                baseGain *= 3;
                isCritical = true;
            }
            
            const oreGain = Math.floor(baseGain * gameState.miningEfficiency);
            gameState.ore += oreGain;
            
            // æ›´é«˜å‡ ç‡è·å¾—é’»çŸ³å’Œå®çŸ³
            let diamondGain = 0;
            let gemGain = 0;
            
            if (Math.random() * 100 < gameState.rarityChance * 5) {
                diamondGain = 1 + Math.floor(Math.random() * 2);
                gameState.diamond += diamondGain;
            }
            
            if (gameState.currentMine >= 3 && Math.random() * 100 < gameState.rarityChance) {
                gemGain = 1;
                gameState.gem += gemGain;
            }
            
            // æˆå°±è¿›åº¦
            updateAchievementProgress('mining', 'blasting-expert', 1);
            
            let message = `${isCritical ? 'è¶…çº§æš´å‡»ï¼' : ''}çˆ†ç ´å¼€é‡‡è·å¾— ${oreGain} çŸ¿çŸ³`;
            if (diamondGain > 0) message += ` å’Œ ${diamondGain} é’»çŸ³`;
            if (gemGain > 0) message += ` ä»¥åŠ ${gemGain} å®çŸ³`;
            message += "ï¼";
            
            showNotification(message);
            
            addExperience(oreGain / 3);
            updateResourcesUI();
            saveGame();
        }

        // å®ŒæˆæŒ–çŸ¿
        function finishMining() {
            clearInterval(miningInterval);
            isMining = false;
            
            let oreGain = gameState.miningEfficiency;
            
            // çŸ¿æ´åŠ æˆ
            if (gameState.currentMine > 0) {
                oreGain *= 1 + (gameState.currentMine * 0.1);
            }
            
            oreGain = Math.floor(oreGain);
            gameState.ore += oreGain;
            
            // ä½“åŠ›æ¶ˆè€—
            gameState.stamina = Math.max(0, gameState.stamina - 2);
            updateStaminaUI();
            
            // ç¨€æœ‰æ‰è½
            let diamondGain = 0;
            if (Math.random() * 100 < gameState.rarityChance) {
                diamondGain = 1;
                gameState.diamond++;
            }
            
            // æˆå°±è¿›åº¦
            updateAchievementProgress('mining', 'beginner', oreGain);
            updateAchievementProgress('mining', 'expert', oreGain);
            updateTaskProgress('daily', 'mining-1', 1);
            
            if (diamondGain > 0) {
                showNotification(`æŒ–çŸ¿è·å¾— ${oreGain} çŸ¿çŸ³å’Œ ${diamondGain} é’»çŸ³ï¼`);
            } else {
                showNotification(`æŒ–çŸ¿è·å¾— ${oreGain} çŸ¿çŸ³ï¼`);
            }
            
            addExperience(oreGain / 10);
            updateResourcesUI();
            saveGame();
        }

        // å¼€å§‹è‡ªåŠ¨æŒ–çŸ¿
        function startAutoMining() {
            if (autoMiningInterval) clearInterval(autoMiningInterval);
            
            autoMiningInterval = setInterval(() => {
                let oreGain = gameState.autoMiners * gameState.miningEfficiency;
                
                // çŸ¿æ´åŠ æˆ
                if (gameState.currentMine > 0) {
                    oreGain *= 1 + (gameState.currentMine * 0.1);
                }
                
                oreGain = Math.floor(oreGain);
                gameState.ore += oreGain;
                
                // éšæœºé’»çŸ³
                for (let i = 0; i < oreGain; i++) {
                    if (Math.random() * 100 < gameState.rarityChance) {
                        gameState.diamond++;
                    }
                }
                
                // æˆå°±è¿›åº¦
                updateAchievementProgress('mining', 'automation', oreGain);
                
                addExperience(oreGain / 20);
                updateResourcesUI();
            }, 1000);
        }

        // é›‡ä½£çŸ¿å·¥
        function hireMiner() {
            if (gameState.gold < gameState.minerCost) {
                showNotification("é‡‘å¸ä¸è¶³ï¼");
                return;
            }
            
            gameState.gold -= gameState.minerCost;
            gameState.autoMiners++;
            gameState.minerCost = Math.floor(gameState.minerCost * 1.5);
            
            if (gameState.autoMiners === 1) {
                startAutoMining();
            }
            
            showNotification(`é›‡ä½£äº†1åè‡ªåŠ¨çŸ¿å·¥ï¼ç°åœ¨å…±æœ‰ ${gameState.autoMiners} åçŸ¿å·¥ã€‚`);
            updateResourcesUI();
            elements.autoMiners.textContent = `è‡ªåŠ¨çŸ¿å·¥: ${gameState.autoMiners}`;
            elements.hireMinerButton.textContent = `é›‡ä½£çŸ¿å·¥ (${gameState.minerCost}é‡‘å¸)`;
            
            // æˆå°±è¿›åº¦
            updateAchievementProgress('workers', 'first-hire', 1);
            
            saveGame();
        }

        // æ¢ç´¢æ–°çŸ¿æ´
        function exploreNewMine() {
            if (gameState.energy < 50) {
                showNotification("èƒ½é‡ä¸è¶³ï¼");
                return;
            }
            
            if (gameState.currentMine >= gameState.minesUnlocked - 1) {
                showNotification("æ²¡æœ‰å¯æ¢ç´¢çš„æ–°çŸ¿æ´ï¼");
                return;
            }
            
            gameState.energy -= 50;
            gameState.currentMine++;
            
            updateEnergyUI();
            elements.currentMine.textContent = `${mineNames[gameState.currentMine]} (ç­‰çº§${gameState.currentMine + 1})`;
            
            showNotification(`å‘ç°äº†æ–°çš„çŸ¿æ´ï¼š${mineNames[gameState.currentMine]}ï¼`);
            
            // æˆå°±è¿›åº¦
            updateAchievementProgress('exploration', 'explorer', 1);
            
            saveGame();
        }

        // è´­ä¹°å‡çº§
        function buyUpgrade(upgrade) {
            let cost, canAfford = false;
            
            switch (upgrade) {
                case 'pickaxe':
                    cost = 50 + (gameState.upgrades.pickaxe * 25);
                    if (gameState.gold >= cost) {
                        gameState.gold -= cost;
                        gameState.upgrades.pickaxe++;
                        gameState.miningEfficiency += 0.5;
                        canAfford = true;
                        
                        // è£…å¤‡å‡çº§
                        gameState.equipment.pickaxe.level++;
                        gameState.equipment.pickaxe.efficiency += 0.5;
                        gameState.equipment.pickaxe.name = getPickaxeName(gameState.equipment.pickaxe.level);
                    }
                    break;
                    
                case 'lamp':
                    cost = 100 + (gameState.upgrades.lamp * 50);
                    if (gameState.gold >= cost) {
                        gameState.gold -= cost;
                        gameState.upgrades.lamp++;
                        gameState.rarityChance += 1;
                        canAfford = true;
                        
                        // è£…å¤‡å‡çº§
                        gameState.equipment.lamp.level++;
                        gameState.equipment.lamp.rarity += 1;
                        gameState.equipment.lamp.name = getLampName(gameState.equipment.lamp.level);
                    }
                    break;
                    
                case 'cart':
                    cost = 500;
                    if (gameState.gold >= cost && !gameState.upgrades.cart) {
                        gameState.gold -= cost;
                        gameState.upgrades.cart = true;
                        canAfford = true;
                    }
                    break;
                    
                case 'blasting':
                    cost = 800;
                    if (gameState.gold >= cost && !gameState.upgrades.blasting) {
                        gameState.gold -= cost;
                        gameState.upgrades.blasting = true;
                        gameState.criticalChance += 2;
                        canAfford = true;
                    }
                    break;
                    
                case 'copper-mine':
                    if (gameState.playerLevel >= 2 && !gameState.upgrades.copperMine) {
                        gameState.upgrades.copperMine = true;
                        gameState.miningEfficiency *= 1.1;
                        gameState.minesUnlocked = Math.max(gameState.minesUnlocked, 2);
                        canAfford = true;
                    }
                    break;
                    
                case 'iron-mine':
                    if (gameState.playerLevel >= 5 && !gameState.upgrades.ironMine) {
                        gameState.upgrades.ironMine = true;
                        gameState.rarityChance += 5;
                        gameState.minesUnlocked = Math.max(gameState.minesUnlocked, 3);
                        canAfford = true;
                    }
                    break;
            }
            
            if (canAfford) {
                showNotification(`å‡çº§æˆåŠŸ: ${upgrade}`);
                updateResourcesUI();
                updateUpgradesUI();
                updateInventoryUI();
                
                // æˆå°±è¿›åº¦
                updateAchievementProgress('upgrades', 'upgrader', 1);
                
                saveGame();
            } else {
                showNotification("é‡‘å¸ä¸è¶³æˆ–æ¡ä»¶ä¸æ»¡è¶³ï¼");
            }
        }

        // å‡ºå”®çŸ¿çŸ³
        function sellOre(percentage) {
            const amount = Math.floor(gameState.ore * percentage);
            if (amount <= 0) {
                showNotification("æ²¡æœ‰çŸ¿çŸ³å¯å‡ºå”®ï¼");
                return;
            }
            
            const total = amount * gameState.orePrice;
            gameState.ore -= amount;
            gameState.gold += total;
            
            // å¸‚åœºå½±å“
            gameState.orePrice = Math.max(5, gameState.orePrice - (amount / 1000));
            
            showNotification(`æˆåŠŸå‡ºå”® ${amount} çŸ¿çŸ³ï¼Œè·å¾— ${total} é‡‘å¸`);
            updateResourcesUI();
            updateMarketUI();
            
            // æˆå°±è¿›åº¦
            updateAchievementProgress('trading', 'first-sale', amount);
            
            saveGame();
        }

        // å‡ºå”®é’»çŸ³
        function sellDiamond(percentage) {
            const amount = Math.floor(gameState.diamond * percentage);
            if (amount <= 0) {
                showNotification("æ²¡æœ‰é’»çŸ³å¯å‡ºå”®ï¼");
                return;
            }
            
            const total = amount * gameState.diamondPrice;
            gameState.diamond -= amount;
            gameState.gold += total;
            
            // å¸‚åœºå½±å“
            gameState.diamondPrice = Math.max(50, gameState.diamondPrice - (amount * 5));
            
            showNotification(`æˆåŠŸå‡ºå”® ${amount} é’»çŸ³ï¼Œè·å¾— ${total} é‡‘å¸`);
            updateResourcesUI();
            updateMarketUI();
            
            // æˆå°±è¿›åº¦
            updateAchievementProgress('trading', 'diamond-seller', amount);
            
            saveGame();
        }

        // æ”¹å˜çŸ¿çŸ³å‡ºå”®é˜ˆå€¼
        function changeOreThreshold(amount) {
            gameState.oreThreshold = Math.max(0, gameState.oreThreshold + amount);
            elements.oreThreshold.textContent = gameState.oreThreshold;
            saveGame();
        }

        // æ”¹å˜é’»çŸ³å‡ºå”®é˜ˆå€¼
        function changeDiamondThreshold(amount) {
            gameState.diamondThreshold = Math.max(0, gameState.diamondThreshold + amount);
            elements.diamondThreshold.textContent = gameState.diamondThreshold;
            saveGame();
        }

        // æ£€æŸ¥è‡ªåŠ¨å‡ºå”®
        function checkAutoSell() {
            if (gameState.oreThreshold > 0 && gameState.ore >= gameState.oreThreshold) {
                sellOre(1); // å‡ºå”®æ‰€æœ‰è¾¾åˆ°é˜ˆå€¼çš„çŸ¿çŸ³
            }
            
            if (gameState.diamondThreshold > 0 && gameState.diamond >= gameState.diamondThreshold) {
                sellDiamond(1); // å‡ºå”®æ‰€æœ‰è¾¾åˆ°é˜ˆå€¼çš„é’»çŸ³
            }
        }

        // æ›´æ–°å¸‚åœºä»·æ ¼
        function updateMarketPrices() {
            // ä¿å­˜æ—§ä»·æ ¼
            const oldOrePrice = gameState.orePrice;
            const oldDiamondPrice = gameState.diamondPrice;
            
            // éšæœºæ³¢åŠ¨
            const oreChange = (Math.random() - 0.5) * (gameState.marketVolatility + 1);
            const diamondChange = (Math.random() - 0.5) * (gameState.marketVolatility + 1) * 5;
            
            gameState.orePrice = Math.max(5, Math.min(20, gameState.orePrice + oreChange));
            gameState.diamondPrice = Math.max(50, Math.min(200, gameState.diamondPrice + diamondChange));
            
            // è®°å½•ä»·æ ¼å†å²
            gameState.orePriceHistory.push(gameState.orePrice);
            gameState.diamondPriceHistory.push(gameState.diamondPrice);
            
            // é™åˆ¶å†å²è®°å½•é•¿åº¦
            if (gameState.orePriceHistory.length > 10) {
                gameState.orePriceHistory.shift();
                gameState.diamondPriceHistory.shift();
            }
            
            // æ›´æ–°å¸‚åœºæ³¢åŠ¨æ€§
            updateMarketVolatility();
            
            // æ›´æ–°UI
            updateMarketUI();
            
            // æ£€æŸ¥ä»·æ ¼è¶‹åŠ¿é€šçŸ¥
            if (gameState.orePrice > oldOrePrice * 1.2) {
                showNotification("çŸ¿çŸ³ä»·æ ¼ä¸Šæ¶¨ä¸­ï¼");
            } else if (gameState.orePrice < oldOrePrice * 0.8) {
                showNotification("çŸ¿çŸ³ä»·æ ¼ä¸‹è·Œä¸­ï¼");
            }
            
            if (gameState.diamondPrice > oldDiamondPrice * 1.2) {
                showNotification("é’»çŸ³ä»·æ ¼ä¸Šæ¶¨ä¸­ï¼");
            } else if (gameState.diamondPrice < oldDiamondPrice * 0.8) {
                showNotification("é’»çŸ³ä»·æ ¼ä¸‹è·Œä¸­ï¼");
            }
        }

        // æ›´æ–°å¸‚åœºæ³¢åŠ¨æ€§
        function updateMarketVolatility() {
            // è®¡ç®—ä»·æ ¼å˜åŒ–å¹…åº¦
            let oreChanges = [];
            let diamondChanges = [];
            
            for (let i = 1; i < gameState.orePriceHistory.length; i++) {
                oreChanges.push(Math.abs(gameState.orePriceHistory[i] - gameState.orePriceHistory[i-1]));
                diamondChanges.push(Math.abs(gameState.diamondPriceHistory[i] - gameState.diamondPriceHistory[i-1]));
            }
            
            const avgOreChange = oreChanges.reduce((a, b) => a + b, 0) / oreChanges.length;
            const avgDiamondChange = diamondChanges.reduce((a, b) => a + b, 0) / diamondChanges.length;
            
            // ç¡®å®šæ³¢åŠ¨æ€§ç­‰çº§
            const totalAvg = (avgOreChange + avgDiamondChange / 5) / 2;
            
            if (totalAvg < 0.5) {
                gameState.marketVolatility = 0;
                gameState.marketVolatilityText = "ä½";
            } else if (totalAvg < 1.5) {
                gameState.marketVolatility = 1;
                gameState.marketVolatilityText = "ä¸­";
            } else {
                gameState.marketVolatility = 2;
                gameState.marketVolatilityText = "é«˜";
            }
        }

        // ä½¿ç”¨ä½“åŠ›è¯å‰‚
        function useStaminaPotion() {
            if (gameState.consumables.staminaPotion <= 0) {
                showNotification("æ²¡æœ‰ä½“åŠ›è¯å‰‚ï¼");
                return;
            }
            
            gameState.consumables.staminaPotion--;
            gameState.stamina = gameState.maxStamina;
            
            showNotification("ä½¿ç”¨ä½“åŠ›è¯å‰‚ï¼Œä½“åŠ›å·²æ¢å¤æ»¡ï¼");
            updateStaminaUI();
            updateInventoryUI();
            saveGame();
        }

        // ä½¿ç”¨èƒ½é‡é¥®æ–™
        function useEnergyDrink() {
            if (gameState.consumables.energyDrink <= 0) {
                showNotification("æ²¡æœ‰èƒ½é‡é¥®æ–™ï¼");
                return;
            }
            
            gameState.consumables.energyDrink--;
            gameState.energy = 100;
            
            showNotification("ä½¿ç”¨èƒ½é‡é¥®æ–™ï¼Œèƒ½é‡å·²æ¢å¤æ»¡ï¼");
            updateEnergyUI();
            updateInventoryUI();
            saveGame();
        }

        // è´­ä¹°å® ç‰©
        function buyPet(petId) {
            const pet = gameState.petShop.find(p => p.id === petId);
            if (!pet) return;
            
            if (gameState.gold < pet.price) {
                showNotification("é‡‘å¸ä¸è¶³ï¼");
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²æ‹¥æœ‰è¯¥å® ç‰©
            if (gameState.pets.some(p => p.id === petId)) {
                showNotification("æ‚¨å·²ç»æ‹¥æœ‰è¿™åªå® ç‰©äº†ï¼");
                return;
            }
            
            gameState.gold -= pet.price;
            gameState.pets.push({
                id: pet.id,
                name: pet.name,
                emoji: pet.emoji,
                level: 1,
                experience: 0,
                bonus: pet.bonus
            });
            
            // åº”ç”¨å® ç‰©åŠ æˆ
            applyPetBonuses();
            
            showNotification(`è·å¾—äº†æ–°å® ç‰©ï¼š${pet.name} ${pet.emoji}`);
            updateResourcesUI();
            updatePetsUI();
            
            // æˆå°±è¿›åº¦
            updateAchievementProgress('pets', 'first-pet', 1);
            
            saveGame();
        }

        // åº”ç”¨å® ç‰©åŠ æˆ
        function applyPetBonuses() {
            // é‡ç½®åŠ æˆ
            gameState.miningEfficiency = 1 + (gameState.upgrades.pickaxe * 0.5);
            if (gameState.upgrades.copperMine) gameState.miningEfficiency *= 1.1;
            
            // åº”ç”¨å® ç‰©åŠ æˆ
            gameState.pets.forEach(pet => {
                if (pet.bonus.efficiency) {
                    gameState.miningEfficiency += pet.bonus.efficiency * pet.level;
                }
                // å¯ä»¥æ·»åŠ å…¶ä»–ç±»å‹çš„åŠ æˆ
            });
            
            updateResourcesUI();
        }

        // åˆ›å»ºå·¥ä¼š
        function createGuild() {
            if (gameState.guild) {
                showNotification("æ‚¨å·²ç»åŠ å…¥å·¥ä¼šäº†ï¼");
                return;
            }
            
            if (gameState.gold < 1000) {
                showNotification("éœ€è¦1000é‡‘å¸åˆ›å»ºå·¥ä¼šï¼");
                return;
            }
            
            gameState.gold -= 1000;
            gameState.guild = {
                name: `çŸ¿å·¥å·¥ä¼š#${Math.floor(Math.random() * 1000)}`,
                level: 1,
                members: 1,
                reputation: 0
            };
            
            showNotification(`åˆ›å»ºäº†æ–°çš„å·¥ä¼šï¼š${gameState.guild.name}`);
            updateResourcesUI();
            updateGuildUI();
            
            // æˆå°±è¿›åº¦
            updateAchievementProgress('guild', 'guild-leader', 1);
            
            saveGame();
        }

        // åŠ å…¥å·¥ä¼š
        function joinGuild() {
            // ç®€åŒ–ç‰ˆï¼Œå®é™…æ¸¸æˆä¸­åº”è¯¥æœ‰å·¥ä¼šåˆ—è¡¨
            if (gameState.guild) {
                showNotification("æ‚¨å·²ç»åŠ å…¥å·¥ä¼šäº†ï¼");
                return;
            }
            
            gameState.guild = {
                name: "çŸ¿å·¥å…„å¼Ÿä¼š",
                level: 3,
                members: 15,
                reputation: 0
            };
            
            showNotification(`åŠ å…¥äº†å·¥ä¼šï¼š${gameState.guild.name}`);
            updateGuildUI();
            
            // æˆå°±è¿›åº¦
            updateAchievementProgress('guild', 'guild-member', 1);
            
            saveGame();
        }

        // è¿›è¡Œç ”ç©¶
        function conductResearch(researchId) {
            const research = gameState.researches[researchId];
            if (!research) return;
            
            if (research.researched) {
                showNotification("å·²ç»ç ”ç©¶è¿‡è¿™ä¸ªé¡¹ç›®äº†ï¼");
                return;
            }
            
            if (gameState.researchPoints < research.cost) {
                showNotification("ç ”ç©¶ç‚¹æ•°ä¸è¶³ï¼");
                return;
            }
            
            gameState.researchPoints -= research.cost;
            research.researched = true;
            
            // åº”ç”¨ç ”ç©¶æ•ˆæœ
            switch (researchId) {
                case 'efficient-mining':
                    gameState.miningEfficiency *= 1.1;
                    break;
                // å¯ä»¥æ·»åŠ å…¶ä»–ç ”ç©¶æ•ˆæœ
            }
            
            showNotification(`ç ”ç©¶å®Œæˆï¼š${research.name}`);
            updateResourcesUI();
            updateResearchUI();
            
            // æˆå°±è¿›åº¦
            updateAchievementProgress('research', 'researcher', 1);
            
            saveGame();
        }

        // è½¬ç”Ÿ
        function prestige() {
            if (gameState.prestigePoints < 1) {
                showNotification("è‡³å°‘éœ€è¦1ç‚¹è½¬ç”Ÿç‚¹æ•°æ‰èƒ½è½¬ç”Ÿï¼");
                return;
            }
            
            // è®¡ç®—ä¿ç•™çš„åŠ æˆ
            let efficiencyBonus = 0;
            if (gameState.prestigeBonuses['keep-efficiency'].purchased) {
                efficiencyBonus = gameState.miningEfficiency * 0.1;
            }
            
            // ç¡®è®¤è½¬ç”Ÿ
            if (!confirm(`ç¡®å®šè¦è½¬ç”Ÿå—ï¼Ÿè¿™å°†é‡ç½®æ‚¨çš„è¿›åº¦ï¼Œä½†ä¼šè·å¾—æ°¸ä¹…åŠ æˆã€‚`)) {
                return;
            }
            
            // å¢åŠ è½¬ç”Ÿæ¬¡æ•°
            gameState.prestige++;
            
            // ä¿å­˜è½¬ç”Ÿç‚¹æ•°
            const earnedPoints = gameState.prestigePoints;
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            const newState = {
                // ä¿ç•™çš„èµ„æº
                gem: gameState.gem,
                prestige: gameState.prestige,
                prestigeBonuses: gameState.prestigeBonuses,
                
                // åŸºç¡€èµ„æº
                gold: 0,
                ore: 0,
                diamond: 0,
                reputation: 0,
                energy: 100,
                
                // çŸ¿å·¥çŠ¶æ€
                stamina: 100,
                maxStamina: 100,
                miningEfficiency: 1 + efficiencyBonus,
                rarityChance: 1,
                criticalChance: 5,
                autoMiners: 0,
                minerCost: 100,
                currentMine: 0,
                minesUnlocked: 1,
                
                // å…¶ä»–
                version: gameState.version,
                lastPlayed: Date.now()
            };
            
            // åº”ç”¨è½¬ç”ŸåŠ æˆ
            let bonusPercent = 0;
            for (const key in newState.prestigeBonuses) {
                if (newState.prestigeBonuses[key].purchased) {
                    bonusPercent += newState.prestigeBonuses[key].bonus * 100;
                }
            }
            
            // åº”ç”¨æ–°çš„æ¸¸æˆçŠ¶æ€
            Object.assign(gameState, newState);
            gameState.prestigePoints = earnedPoints;
            
            showNotification(`è½¬ç”ŸæˆåŠŸï¼è·å¾— ${earnedPoints} è½¬ç”Ÿç‚¹æ•°ã€‚æ°¸ä¹…åŠ æˆ: +${bonusPercent}% æ•ˆç‡`);
            updateUI();
            
            // æˆå°±è¿›åº¦
            updateAchievementProgress('prestige', 'first-prestige', 1);
            
            saveGame();
        }

        // åˆå§‹åŒ–æˆå°±ç³»ç»Ÿ
        function initAchievements() {
            // æŒ–çŸ¿æˆå°±
            gameState.achievements.mining = {
                'beginner': { name: 'åˆå‡ºèŒ…åº', desc: 'æŒ–åˆ°100çŸ¿çŸ³', goal: 100, progress: 0, completed: false, reward: 50 },
                'expert': { name: 'æŒ–çŸ¿ä¸“å®¶', desc: 'æŒ–åˆ°1000çŸ¿çŸ³', goal: 1000, progress: 0, completed: false, reward: 200 },
                'deep-miner': { name: 'æ·±åº¦çŸ¿å·¥', desc: 'è¿›è¡Œ10æ¬¡æ·±åº¦æŒ–æ˜', goal: 10, progress: 0, completed: false, reward: 150 },
                'blasting-expert': { name: 'çˆ†ç ´ä¸“å®¶', desc: 'è¿›è¡Œ5æ¬¡çˆ†ç ´å¼€é‡‡', goal: 5, progress: 0, completed: false, reward: 300 },
                'automation': { name: 'è‡ªåŠ¨åŒ–', desc: 'ç´¯è®¡è‡ªåŠ¨æŒ–çŸ¿è·å¾—5000çŸ¿çŸ³', goal: 5000, progress: 0, completed: false, reward: 500 },
                // å¯ä»¥æ·»åŠ æ›´å¤šæŒ–çŸ¿æˆå°±
            };
            
            // å…¶ä»–ç±»åˆ«æˆå°±
            gameState.achievements.workers = {
                'first-hire': { name: 'ç¬¬ä¸€å‘˜å·¥', desc: 'é›‡ä½£ç¬¬ä¸€ä¸ªè‡ªåŠ¨çŸ¿å·¥', goal: 1, progress: 0, completed: false, reward: 100 },
                // å¯ä»¥æ·»åŠ æ›´å¤šå·¥äººæˆå°±
            };
            
            gameState.achievements.trading = {
                'first-sale': { name: 'ç¬¬ä¸€æ¡¶é‡‘', desc: 'å‡ºå”®100çŸ¿çŸ³', goal: 100, progress: 0, completed: false, reward: 50 },
                'diamond-seller': { name: 'é’»çŸ³å•†äºº', desc: 'å‡ºå”®10é’»çŸ³', goal: 10, progress: 0, completed: false, reward: 200 },
                // å¯ä»¥æ·»åŠ æ›´å¤šäº¤æ˜“æˆå°±
            };
            
            gameState.achievements.upgrades = {
                'upgrader': { name: 'å‡çº§è¾¾äºº', desc: 'è¿›è¡Œ5æ¬¡å‡çº§', goal: 5, progress: 0, completed: false, reward: 150 },
                // å¯ä»¥æ·»åŠ æ›´å¤šå‡çº§æˆå°±
            };
            
            gameState.achievements.exploration = {
                'explorer': { name: 'æ¢é™©å®¶', desc: 'æ¢ç´¢3ä¸ªä¸åŒçŸ¿æ´', goal: 3, progress: 0, completed: false, reward: 300 },
                // å¯ä»¥æ·»åŠ æ›´å¤šæ¢ç´¢æˆå°±
            };
            
            gameState.achievements.pets = {
                'first-pet': { name: 'å® ç‰©çˆ±å¥½è€…', desc: 'è·å¾—ç¬¬ä¸€ä¸ªå® ç‰©', goal: 1, progress: 0, completed: false, reward: 100 },
                // å¯ä»¥æ·»åŠ æ›´å¤šå® ç‰©æˆå°±
            };
            
            gameState.achievements.guild = {
                'guild-member': { name: 'å·¥ä¼šæˆå‘˜', desc: 'åŠ å…¥ä¸€ä¸ªå·¥ä¼š', goal: 1, progress: 0, completed: false, reward: 200 },
                'guild-leader': { name: 'å·¥ä¼šé¢†è¢–', desc: 'åˆ›å»ºä¸€ä¸ªå·¥ä¼š', goal: 1, progress: 0, completed: false, reward: 500 },
                // å¯ä»¥æ·»åŠ æ›´å¤šå·¥ä¼šæˆå°±
            };
            
            gameState.achievements.research = {
                'researcher': { name: 'ç ”ç©¶å‘˜', desc: 'å®Œæˆä¸€é¡¹ç ”ç©¶', goal: 1, progress: 0, completed: false, reward: 200 },
                // å¯ä»¥æ·»åŠ æ›´å¤šç ”ç©¶æˆå°±
            };
            
            gameState.achievements.prestige = {
                'first-prestige': { name: 'æ–°çš„å¼€å§‹', desc: 'ç¬¬ä¸€æ¬¡è½¬ç”Ÿ', goal: 1, progress: 0, completed: false, reward: 1000 },
                // å¯ä»¥æ·»åŠ æ›´å¤šè½¬ç”Ÿæˆå°±
            };
            
            // åˆå§‹åŒ–æˆå°±UI
            updateAchievementsUI();
        }

        // åˆå§‹åŒ–ä»»åŠ¡ç³»ç»Ÿ
        function initTasks() {
            // æ¯æ—¥ä»»åŠ¡
            gameState.dailyTasks = {
                'mining-1': { name: 'æŒ–çŸ¿æ–°æ‰‹', desc: 'æŒ–çŸ¿50æ¬¡', goal: 50, progress: 0, reward: 100, completed: false },
                'selling-1': { name: 'å°å•†è´©', desc: 'å‡ºå”®200çŸ¿çŸ³', goal: 200, progress: 0, reward: 150, completed: false },
                // å¯ä»¥æ·»åŠ æ›´å¤šæ¯æ—¥ä»»åŠ¡
            };
            
            // ä¸»çº¿ä»»åŠ¡
            gameState.mainTasks = {
                'first-gold': { name: 'ç¬¬ä¸€æ¡¶é‡‘', desc: 'ç§¯ç´¯1000é‡‘å¸', goal: 1000, progress: 0, reward: 'unlock-mine', completed: false },
                'deep-mining': { name: 'æ·±åº¦æŒ–æ˜', desc: 'è¿›è¡Œ5æ¬¡æ·±åº¦æŒ–æ˜', goal: 5, progress: 0, reward: 'unlock-blasting', completed: false },
                // å¯ä»¥æ·»åŠ æ›´å¤šä¸»çº¿ä»»åŠ¡
            };
            
            // åˆå§‹åŒ–ä»»åŠ¡UI
            updateTasksUI();
        }

        // æ›´æ–°æˆå°±è¿›åº¦
        function updateAchievementProgress(category, id, amount) {
            const achievement = gameState.achievements[category]?.[id];
            if (!achievement || achievement.completed) return;
            
            achievement.progress += amount;
            
            if (achievement.progress >= achievement.goal) {
                achievement.completed = true;
                gameState.achievementPoints += achievement.reward;
                gameState.gold += achievement.reward;
                
                showNotification(`æˆå°±è¾¾æˆï¼š${achievement.name}ï¼è·å¾— ${achievement.reward} é‡‘å¸å’Œæˆå°±ç‚¹æ•°`);
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æˆå°±ç›¸å…³çš„å¥–åŠ±
                if (category === 'mining' && id === 'expert') {
                    gameState.upgrades.copperMine = true;
                    gameState.minesUnlocked = Math.max(gameState.minesUnlocked, 2);
                    showNotification("è§£é”äº†é“œçŸ¿æ´ï¼");
                }
            }
            
            updateAchievementsUI();
            updateResourcesUI();
            saveGame();
        }

        // æ›´æ–°ä»»åŠ¡è¿›åº¦
        function updateTaskProgress(type, id, amount) {
            const tasks = type === 'daily' ? gameState.dailyTasks : gameState.mainTasks;
            const task = tasks[id];
            if (!task || task.completed) return;
            
            task.progress += amount;
            
            if (task.progress >= task.goal) {
                task.completed = true;
                
                if (typeof task.reward === 'number') {
                    gameState.gold += task.reward;
                    showNotification(`ä»»åŠ¡å®Œæˆï¼š${task.name}ï¼è·å¾— ${task.reward} é‡‘å¸`);
                } else if (task.reward === 'unlock-mine') {
                    gameState.upgrades.copperMine = true;
                    gameState.minesUnlocked = Math.max(gameState.minesUnlocked, 2);
                    showNotification(`ä»»åŠ¡å®Œæˆï¼š${task.name}ï¼è§£é”äº†é“œçŸ¿æ´`);
                } else if (task.reward === 'unlock-blasting') {
                    gameState.upgrades.blasting = true;
                    gameState.criticalChance += 2;
                    showNotification(`ä»»åŠ¡å®Œæˆï¼š${task.name}ï¼è§£é”äº†çˆ†ç ´å¼€é‡‡`);
                }
            }
            
            updateTasksUI();
            updateResourcesUI();
            saveGame();
        }

        // æ£€æŸ¥æ¯æ—¥ä»»åŠ¡é‡ç½®
        function checkDailyReset() {
            const now = new Date();
            const lastReset = new Date(gameState.lastDailyReset);
            
            // å¦‚æœä¸åœ¨åŒä¸€å¤©
            if (now.getDate() !== lastReset.getDate() || 
                now.getMonth() !== lastReset.getMonth() || 
                now.getFullYear() !== lastReset.getFullYear()) {
                
                // é‡ç½®æ¯æ—¥ä»»åŠ¡
                for (const key in gameState.dailyTasks) {
                    gameState.dailyTasks[key].progress = 0;
                    gameState.dailyTasks[key].completed = false;
                }
                
                gameState.lastDailyReset = Date.now();
                showNotification("æ–°çš„ä¸€å¤©å¼€å§‹äº†ï¼Œæ¯æ—¥ä»»åŠ¡å·²é‡ç½®ï¼");
                
                updateTasksUI();
                saveGame();
            }
        }

        // è§¦å‘éšæœºäº‹ä»¶
        function triggerRandomEvent() {
            const events = [
                {
                    title: "å‘ç°ç¨€æœ‰çŸ¿è„‰",
                    content: "çŸ¿å·¥æŠ¥å‘Šå‘ç°äº†ä¸€ä¸ªå¯èƒ½å«æœ‰ä¸°å¯Œèµ„æºçš„çŸ¿è„‰ï¼Œä½†è¦å¼€é‡‡éœ€è¦æ”¯ä»˜200é‡‘å¸çš„è®¾å¤‡è´¹ç”¨ã€‚",
                    accept: () => {
                        if (gameState.gold >= 200) {
                            gameState.gold -= 200;
                            const reward = 500 + Math.floor(Math.random() * 500);
                            gameState.gold += reward;
                            showNotification(`å¼€é‡‡æˆåŠŸï¼è·å¾— ${reward} é‡‘å¸`);
                            updateResourcesUI();
                            return true;
                        } else {
                            showNotification("é‡‘å¸ä¸è¶³ï¼");
                            return false;
                        }
                    },
                    decline: () => {
                        showNotification("ä½ å†³å®šæ”¾å¼ƒè¿™ä¸ªæœºä¼š");
                    }
                },
                {
                    title: "é“¶è¡Œä¿ƒé”€",
                    content: "é“¶è¡Œæ­£åœ¨ä¸¾è¡Œä¿ƒé”€æ´»åŠ¨ï¼Œç°åœ¨å­˜æ¬¾å¯è·å¾—åŒå€åˆ©æ¯ä¸€å¤©ï¼",
                    accept: () => {
                        const oldRate = gameState.interestRate;
                        gameState.interestRate *= 2;
                        showNotification(`ä»Šæ—¥åˆ©æ¯æå‡åˆ° ${gameState.interestRate}%`);
                        setTimeout(() => {
                            gameState.interestRate = oldRate;
                            showNotification("ä¿ƒé”€ç»“æŸï¼Œåˆ©æ¯æ¢å¤æ­£å¸¸");
                        }, 86400000); // 24å°æ—¶åæ¢å¤
                        return true;
                    },
                    decline: () => {
                        showNotification("ä½ å†³å®šä¸å‚åŠ è¿™æ¬¡ä¿ƒé”€");
                    }
                },
                {
                    title: "çŸ¿å·¥ç½¢å·¥",
                    content: "ä½ çš„è‡ªåŠ¨çŸ¿å·¥è¦æ±‚æ›´å¥½çš„å·¥ä½œæ¡ä»¶ï¼Œè¦ä¹ˆæ”¯ä»˜æ¯äºº50é‡‘å¸ï¼Œè¦ä¹ˆä»–ä»¬ä»Šå¤©æ•ˆç‡å‡åŠã€‚",
                    accept: () => {
                        const cost = gameState.autoMiners * 50;
                        if (gameState.gold >= cost) {
                            gameState.gold -= cost;
                            showNotification(`æ”¯ä»˜äº† ${cost} é‡‘å¸å¹³æ¯ç½¢å·¥`);
                            updateResourcesUI();
                            return true;
                        } else {
                            showNotification("é‡‘å¸ä¸è¶³ï¼ŒçŸ¿å·¥æ•ˆç‡å‡åŠä¸€å¤©");
                            const oldEfficiency = gameState.miningEfficiency;
                            gameState.miningEfficiency /= 2;
                            setTimeout(() => {
                                gameState.miningEfficiency = oldEfficiency;
                                showNotification("ç½¢å·¥ç»“æŸï¼Œæ•ˆç‡æ¢å¤æ­£å¸¸");
                            }, 86400000); // 24å°æ—¶åæ¢å¤
                            return true;
                        }
                    },
                    decline: () => {
                        showNotification("çŸ¿å·¥æ•ˆç‡å‡åŠä¸€å¤©");
                        const oldEfficiency = gameState.miningEfficiency;
                        gameState.miningEfficiency /= 2;
                        setTimeout(() => {
                            gameState.miningEfficiency = oldEfficiency;
                            showNotification("ç½¢å·¥ç»“æŸï¼Œæ•ˆç‡æ¢å¤æ­£å¸¸");
                        }, 86400000); // 24å°æ—¶åæ¢å¤
                    }
                },
                {
                    title: "ç¥ç§˜å•†äºº",
                    content: "ä¸€ä¸ªç¥ç§˜å•†äººæä¾›ç‰¹ä»·å•†å“ï¼š1ä¸ªèƒ½é‡é¥®æ–™åªè¦80é‡‘å¸ï¼ˆåŸä»·100é‡‘å¸ï¼‰ã€‚",
                    accept: () => {
                        if (gameState.gold >= 80) {
                            gameState.gold -= 80;
                            gameState.consumables.energyDrink++;
                            showNotification("è´­ä¹°äº†1ä¸ªèƒ½é‡é¥®æ–™");
                            updateResourcesUI();
                            updateInventoryUI();
                            return true;
                        } else {
                            showNotification("é‡‘å¸ä¸è¶³ï¼");
                            return false;
                        }
                    },
                    decline: () => {
                        showNotification("ä½ å†³å®šä¸è´­ä¹°");
                    }
                },
                {
                    title: "çŸ¿æ´åå¡Œ",
                    content: "ä½ çš„çŸ¿æ´å‘ç”Ÿäº†éƒ¨åˆ†åå¡Œï¼éœ€è¦æ”¯ä»˜100é‡‘å¸ä¿®å¤ï¼Œå¦åˆ™æŒ–çŸ¿æ•ˆç‡é™ä½20%ä¸€å¤©ã€‚",
                    accept: () => {
                        if (gameState.gold >= 100) {
                            gameState.gold -= 100;
                            showNotification("æ”¯ä»˜äº†100é‡‘å¸ä¿®å¤çŸ¿æ´");
                            updateResourcesUI();
                            return true;
                        } else {
                            showNotification("é‡‘å¸ä¸è¶³ï¼ŒæŒ–çŸ¿æ•ˆç‡é™ä½20%ä¸€å¤©");
                            const oldEfficiency = gameState.miningEfficiency;
                            gameState.miningEfficiency *= 0.8;
                            setTimeout(() => {
                                gameState.miningEfficiency = oldEfficiency;
                                showNotification("çŸ¿æ´ä¿®å¤å®Œæˆï¼Œæ•ˆç‡æ¢å¤æ­£å¸¸");
                            }, 86400000); // 24å°æ—¶åæ¢å¤
                            return true;
                        }
                    },
                    decline: () => {
                        showNotification("æŒ–çŸ¿æ•ˆç‡é™ä½20%ä¸€å¤©");
                        const oldEfficiency = gameState.miningEfficiency;
                        gameState.miningEfficiency *= 0.8;
                        setTimeout(() => {
                            gameState.miningEfficiency = oldEfficiency;
                            showNotification("çŸ¿æ´ä¿®å¤å®Œæˆï¼Œæ•ˆç‡æ¢å¤æ­£å¸¸");
                        }, 86400000); // 24å°æ—¶åæ¢å¤
                    }
                }
            ];
            
            const randomEvent = events[Math.floor(Math.random() * events.length)];
            elements.eventContent.innerHTML = `<h4>${randomEvent.title}</h4><p>${randomEvent.content}</p>`;
            elements.eventPopup.style.display = 'block';
            
            // è®¾ç½®äº‹ä»¶æŒ‰é’®è¡Œä¸º
            elements.eventAccept.onclick = () => {
                if (randomEvent.accept()) {
                    elements.eventPopup.style.display = 'none';
                    scheduleNextEvent();
                }
            };
            
            elements.eventDecline.onclick = () => {
                randomEvent.decline();
                elements.eventPopup.style.display = 'none';
                scheduleNextEvent();
            };
        }

        // æ¥å—äº‹ä»¶
        function acceptEvent() {
            // å®é™…è¡Œä¸ºåœ¨triggerRandomEventä¸­åŠ¨æ€è®¾ç½®
        }

        // æ‹’ç»äº‹ä»¶
        function declineEvent() {
            // å®é™…è¡Œä¸ºåœ¨triggerRandomEventä¸­åŠ¨æ€è®¾ç½®
        }

        // å®‰æ’ä¸‹ä¸€ä¸ªäº‹ä»¶
        function scheduleNextEvent() {
            clearTimeout(eventTimeout);
            eventTimeout = setTimeout(triggerRandomEvent, getRandomTime(120000, 300000));
        }

        // æ·»åŠ ç»éªŒå€¼
        function addExperience(amount) {
            // è½¬ç”ŸåŠ æˆ
            if (gameState.prestigeBonuses['keep-efficiency'].purchased) {
                amount *= 1.1;
            }
            
            gameState.experience += amount;
            if (gameState.experience >= gameState.nextLevelExp) {
                levelUp();
            }
            
            // æ›´æ–°UI
            elements.playerLevel.textContent = `ç­‰çº§: ${gameState.playerLevel} (${Math.floor(gameState.experience / gameState.nextLevelExp * 100)}%)`;
        }

        // å‡çº§
        function levelUp() {
            gameState.playerLevel++;
            gameState.experience -= gameState.nextLevelExp;
            gameState.nextLevelExp = Math.floor(gameState.nextLevelExp * 1.5);
            
            // å‡çº§å¥–åŠ±
            gameState.maxStamina += 10;
            gameState.stamina = gameState.maxStamina;
            
            showNotification(`å‡çº§åˆ° ${gameState.playerLevel} çº§ï¼æœ€å¤§ä½“åŠ›å¢åŠ ï¼`);
            updateStaminaUI();
            elements.playerLevel.textContent = `ç­‰çº§: ${gameState.playerLevel}`;
            
            // æ£€æŸ¥æ˜¯å¦è§£é”é“œçŸ¿
            if (gameState.playerLevel >= 2 && !gameState.upgrades.copperMine) {
                document.querySelector('[data-upgrade="copper-mine"]').disabled = false;
                document.querySelector('[data-upgrade="copper-mine"]').previousElementSibling.firstElementChild.textContent = "å…è´¹è§£é”";
                showNotification("å·²è§£é”é“œçŸ¿æ´ï¼");
            }
            
            // æ£€æŸ¥æ˜¯å¦è§£é”é“çŸ¿
            if (gameState.playerLevel >= 5 && !gameState.upgrades.ironMine) {
                document.querySelector('[data-upgrade="iron-mine"]').disabled = false;
                document.querySelector('[data-upgrade="iron-mine"]').previousElementSibling.firstElementChild.textContent = "å…è´¹è§£é”";
                showNotification("å·²è§£é”é“çŸ¿æ´ï¼");
            }
            
            // æˆå°±è¿›åº¦
            updateAchievementProgress('level', 'level-up', 1);
            
            saveGame();
        }

        // è®¡ç®—ç¦»çº¿è¿›åº¦
        function calculateOfflineProgress() {
            // å·²ç»åœ¨loadGameä¸­å¤„ç†
        }

        // è·å–é•å¤´åç§°
        function getPickaxeName(level) {
            const names = ['åŸºç¡€é•', 'é“œé•', 'é“é•', 'é’¢é•', 'é‡‘é•', 'é’»çŸ³é•', 'ç§˜é“¶é•', 'ç²¾é‡‘é•'];
            return names[Math.min(level - 1, names.length - 1)] || `é«˜çº§é•+${level - names.length}`;
        }

        // è·å–çŸ¿ç¯åç§°
        function getLampName(level) {
            const names = ['åŸºç¡€ç¯', 'é“œç¯', 'é“ç¯', 'ç”µç¯', 'çŸ¿å·¥å¸½', 'å¤´æˆ´æ¢ç…§ç¯', 'æ¿€å…‰ç…§æ˜'];
            return names[Math.min(level - 1, names.length - 1)] || `é«˜çº§ç¯+${level - names.length}`;
        }

        // æ›´æ–°UI
        function updateUI() {
            updateResourcesUI();
            updateStaminaUI();
            updateEnergyUI();
            updateUpgradesUI();
            updateMarketUI();
            updateAchievementsUI();
            updateTasksUI();
            updateInventoryUI();
            updatePetsUI();
            updateGuildUI();
            updateResearchUI();
            updatePrestigeUI();
        }

        // æ›´æ–°èµ„æºUI
        function updateResourcesUI() {
            elements.gold.textContent = Math.floor(gameState.gold);
            elements.ore.textContent = Math.floor(gameState.ore);
            elements.diamond.textContent = Math.floor(gameState.diamond);
            elements.reputation.textContent = Math.floor(gameState.reputation);
            elements.energy.textContent = Math.floor(gameState.energy);
            elements.gem.textContent = Math.floor(gameState.gem);
            elements.miningEfficiency.textContent = gameState.miningEfficiency.toFixed(1);
            elements.rarityChance.textContent = gameState.rarityChance.toFixed(1);
            elements.criticalChance.textContent = gameState.criticalChance.toFixed(1);
            elements.autoMiners.textContent = `è‡ªåŠ¨çŸ¿å·¥: ${gameState.autoMiners}`;
            elements.hireMinerButton.textContent = `é›‡ä½£çŸ¿å·¥ (${gameState.minerCost}é‡‘å¸)`;
            elements.playerLevel.textContent = `ç­‰çº§: ${gameState.playerLevel} (${Math.floor(gameState.experience / gameState.nextLevelExp * 100)}%)`;
            elements.currentMine.textContent = `${mineNames[gameState.currentMine]} (ç­‰çº§${gameState.currentMine + 1})`;
        }

        // æ›´æ–°ä½“åŠ›UI
        function updateStaminaUI() {
            elements.stamina.textContent = Math.floor(gameState.stamina);
            elements.maxStamina.textContent = Math.floor(gameState.maxStamina);
            elements.staminaProgress.style.width = `${(gameState.stamina / gameState.maxStamina) * 100}%`;
        }

        // æ›´æ–°èƒ½é‡UI
        function updateEnergyUI() {
            elements.energyValue.textContent = Math.floor(gameState.energy);
            elements.energyProgress.style.width = `${gameState.energy}%`;
        }

        // æ›´æ–°å‡çº§UI
        function updateUpgradesUI() {
            document.querySelector('[data-upgrade="pickaxe"]').previousElementSibling.firstElementChild.textContent = 
                `${50 + (gameState.upgrades.pickaxe * 25)}é‡‘å¸`;
            document.querySelector('[data-upgrade="lamp"]').previousElementSibling.firstElementChild.textContent = 
                `${100 + (gameState.upgrades.lamp * 50)}é‡‘å¸`;
                
            if (gameState.upgrades.cart) {
                document.querySelector('[data-upgrade="cart"]').disabled = true;
                document.querySelector('[data-upgrade="cart"]').textContent = "å·²è§£é”";
            }
            
            if (gameState.upgrades.blasting) {
                document.querySelector('[data-upgrade="blasting"]').disabled = true;
                document.querySelector('[data-upgrade="blasting"]').textContent = "å·²è§£é”";
            }
            
            if (gameState.upgrades.copperMine) {
                document.querySelector('[data-upgrade="copper-mine"]').disabled = true;
                document.querySelector('[data-upgrade="copper-mine"]').textContent = "å·²è§£é”";
            }
            
            if (gameState.upgrades.ironMine) {
                document.querySelector('[data-upgrade="iron-mine"]').disabled = true;
                document.querySelector('[data-upgrade="iron-mine"]').textContent = "å·²è§£é”";
            }
        }

        // æ›´æ–°å¸‚åœºUI
        function updateMarketUI() {
            elements.orePrice.textContent = gameState.orePrice.toFixed(1);
            elements.diamondPrice.textContent = gameState.diamondPrice.toFixed(1);
            
            // æ›´æ–°ä»·æ ¼è¶‹åŠ¿
            if (gameState.orePriceHistory.length > 1) {
                const last = gameState.orePriceHistory[gameState.orePriceHistory.length - 1];
                const prev = gameState.orePriceHistory[gameState.orePriceHistory.length - 2];
                
                if (last > prev) {
                    elements.oreTrend.textContent = "â†‘";
                    elements.oreTrend.className = "market-trend trend-up";
                } else if (last < prev) {
                    elements.oreTrend.textContent = "â†“";
                    elements.oreTrend.className = "market-trend trend-down";
                } else {
                    elements.oreTrend.textContent = "â†’";
                    elements.oreTrend.className = "market-trend trend-neutral";
                }
            }
            
            if (gameState.diamondPriceHistory.length > 1) {
                const last = gameState.diamondPriceHistory[gameState.diamondPriceHistory.length - 1];
                const prev = gameState.diamondPriceHistory[gameState.diamondPriceHistory.length - 2];
                
                if (last > prev) {
                    elements.diamondTrend.textContent = "â†‘";
                    elements.diamondTrend.className = "market-trend trend-up";
                } else if (last < prev) {
                    elements.diamondTrend.textContent = "â†“";
                    elements.diamondTrend.className = "market-trend trend-down";
                } else {
                    elements.diamondTrend.textContent = "â†’";
                    elements.diamondTrend.className = "market-trend trend-neutral";
                }
            }
            
            elements.marketVolatility.textContent = gameState.marketVolatilityText;
            elements.oreThreshold.textContent = gameState.oreThreshold;
            elements.diamondThreshold.textContent = gameState.diamondThreshold;
        }

        // æ›´æ–°æˆå°±UI
        function updateAchievementsUI() {
            let completedCount = 0;
            let totalCount = 0;
            
            // æŒ–çŸ¿æˆå°±
            elements.miningAchievements.innerHTML = '';
            for (const key in gameState.achievements.mining) {
                const achievement = gameState.achievements.mining[key];
                totalCount++;
                if (achievement.completed) completedCount++;
                
                const progressPercent = Math.min(100, (achievement.progress / achievement.goal) * 100);
                
                const achievementElement = document.createElement('div');
                achievementElement.className = `achievement ${achievement.completed ? 'unlocked' : ''}`;
                achievementElement.innerHTML = `
                    <div class="upgrade-name">${achievement.name} ${achievement.completed ? 'âœ“' : ''}</div>
                    <div class="upgrade-description">${achievement.desc}</div>
                    <div class="achievement-progress">
                        <div class="achievement-progress-bar" style="width: ${progressPercent}%;"></div>
                    </div>
                `;
                
                elements.miningAchievements.appendChild(achievementElement);
            }
            
            elements.achievementsCompleted.textContent = completedCount;
            elements.achievementPoints.textContent = gameState.achievementPoints;
        }

        // æ›´æ–°ä»»åŠ¡UI
        function updateTasksUI() {
            // æ¯æ—¥ä»»åŠ¡
            elements.dailyTasks.innerHTML = '';
            for (const key in gameState.dailyTasks) {
                const task = gameState.dailyTasks[key];
                const progressPercent = Math.min(100, (task.progress / task.goal) * 100);
                
                const taskElement = document.createElement('div');
                taskElement.className = 'task-item';
                taskElement.innerHTML = `
                    <div class="upgrade-name">${task.name} ${task.completed ? 'âœ“' : ''}</div>
                    <div class="upgrade-description">${task.desc}</div>
                    <div class="task-reward">å¥–åŠ±: ${typeof task.reward === 'number' ? task.reward + 'é‡‘å¸' : task.reward}</div>
                    <div class="achievement-progress">
                        <div class="achievement-progress-bar" style="width: ${progressPercent}%;"></div>
                    </div>
                `;
                
                elements.dailyTasks.appendChild(taskElement);
            }
            
            // ä¸»çº¿ä»»åŠ¡
            elements.mainTasks.innerHTML = '';
            for (const key in gameState.mainTasks) {
                const task = gameState.mainTasks[key];
                const progressPercent = Math.min(100, (task.progress / task.goal) * 100);
                
                const taskElement = document.createElement('div');
                taskElement.className = 'task-item';
                taskElement.innerHTML = `
                    <div class="upgrade-name">${task.name} ${task.completed ? 'âœ“' : ''}</div>
                    <div class="upgrade-description">${task.desc}</div>
                    <div class="task-reward">å¥–åŠ±: ${typeof task.reward === 'number' ? task.reward + 'é‡‘å¸' : task.reward}</div>
                    <div class="achievement-progress">
                        <div class="achievement-progress-bar" style="width: ${progressPercent}%;"></div>
                    </div>
                `;
                
                elements.mainTasks.appendChild(taskElement);
            }
        }

        // æ›´æ–°èƒŒåŒ…UI
        function updateInventoryUI() {
            // è£…å¤‡
            elements.pickaxeEquip.textContent = gameState.equipment.pickaxe.name;
            elements.lampEquip.textContent = gameState.equipment.lamp.name;
            
            // æ¶ˆè€—å“
            elements.staminaPotion.textContent = gameState.consumables.staminaPotion;
            elements.energyDrink.textContent = gameState.consumables.energyDrink;
            
            // å…¶ä»–ç‰©å“
            elements.otherItems.innerHTML = '';
            for (const key in gameState.items) {
                const item = gameState.items[key];
                
                const itemElement = document.createElement('div');
                itemElement.className = 'inventory-item';
                itemElement.innerHTML = `
                    <div>${item.name}: ${item.quantity}</div>
                    <button class="button">ä½¿ç”¨</button>
                `;
                
                elements.otherItems.appendChild(itemElement);
            }
        }

        // æ›´æ–°å® ç‰©UI
        function updatePetsUI() {
            // æˆ‘çš„å® ç‰©
            elements.myPets.innerHTML = '';
            
            if (gameState.pets.length === 0) {
                const noPetElement = document.createElement('div');
                noPetElement.className = 'pet-card';
                noPetElement.innerHTML = `
                    <div class="pet-image">?</div>
                    <div>æš‚æ— å® ç‰©</div>
                `;
                elements.myPets.appendChild(noPetElement);
            } else {
                gameState.pets.forEach(pet => {
                    const petElement = document.createElement('div');
                    petElement.className = 'pet-card';
                    petElement.innerHTML = `
                        <div class="pet-image">${pet.emoji}</div>
                        <div>${pet.name} (ç­‰çº§ ${pet.level})</div>
                        <div class="upgrade-description">æŒ–çŸ¿æ•ˆç‡ +${pet.bonus.efficiency * pet.level}/ç§’</div>
                        <div class="pet-skill">æŒ–çŸ¿åŠ©æ‰‹</div>
                    `;
                    elements.myPets.appendChild(petElement);
                });
            }
            
            // å® ç‰©å•†åº—
            elements.petShop.innerHTML = '';
            gameState.petShop.forEach(pet => {
                // æ£€æŸ¥æ˜¯å¦å·²æ‹¥æœ‰
                const owned = gameState.pets.some(p => p.id === pet.id);
                
                const petElement = document.createElement('div');
                petElement.className = 'pet-card';
                petElement.innerHTML = `
                    <div class="pet-image">${pet.emoji}</div>
                    <div>${pet.name}</div>
                    <div>ä»·æ ¼: ${pet.price}é‡‘å¸</div>
                    <div class="upgrade-description">${pet.bonus.efficiency ? `æé«˜æŒ–çŸ¿æ•ˆç‡ +${pet.bonus.efficiency}/ç§’` : ''}</div>
                    <button class="button" data-pet="${pet.id}" ${owned ? 'disabled' : ''}>${owned ? 'å·²æ‹¥æœ‰' : 'è´­ä¹°'}</button>
                `;
                elements.petShop.appendChild(petElement);
            });
        }

        // æ›´æ–°å·¥ä¼šUI
        function updateGuildUI() {
            if (gameState.guild) {
                elements.myGuild.innerHTML = `
                    <div>å·¥ä¼šåç§°: ${gameState.guild.name}</div>
                    <div>å·¥ä¼šç­‰çº§: ${gameState.guild.level}</div>
                    <div>æˆå‘˜æ•°é‡: ${gameState.guild.members}</div>
                    <div>å·¥ä¼šå£°æœ›: ${gameState.guild.reputation}</div>
                `;
            } else {
                elements.myGuild.innerHTML = `
                    <div>æ‚¨å°šæœªåŠ å…¥å·¥ä¼š</div>
                    <button class="button" id="create-guild-button">åˆ›å»ºå·¥ä¼š (1000é‡‘å¸)</button>
                    <button class="button" id="join-guild-button">åŠ å…¥å·¥ä¼š</button>
                `;
            }
            
            // æ›´æ–°å·¥ä¼šæŠ€èƒ½
            elements.guildSkills.innerHTML = '';
            for (const key in gameState.guildSkills) {
                const skill = gameState.guildSkills[key];
                
                const skillElement = document.createElement('div');
                skillElement.className = 'upgrade-item';
                skillElement.innerHTML = `
                    <div class="upgrade-info">
                        <div class="upgrade-name">${skill.name}</div>
                        <div class="upgrade-description">${skill.desc}</div>
                    </div>
                    <div class="upgrade-cost">
                        <div>${skill.cost}å£°æœ›</div>
                        <button class="button upgrade" data-guild-skill="${key}" ${skill.learned ? 'disabled' : ''}>${skill.learned ? 'å·²å­¦ä¹ ' : 'å­¦ä¹ '}</button>
                    </div>
                `;
                
                elements.guildSkills.appendChild(skillElement);
            }
        }

        // æ›´æ–°ç ”ç©¶UI
        function updateResearchUI() {
            elements.researchPoints.textContent = gameState.researchPoints;
            
            elements.availableResearch.innerHTML = '';
            for (const key in gameState.researches) {
                const research = gameState.researches[key];
                
                const researchElement = document.createElement('div');
                researchElement.className = 'upgrade-item';
                researchElement.innerHTML = `
                    <div class="upgrade-info">
                        <div class="upgrade-name">${research.name}</div>
                        <div class="upgrade-description">${research.desc}</div>
                    </div>
                    <div class="upgrade-cost">
                        <div>${research.cost}ç ”ç©¶ç‚¹</div>
                        <button class="button upgrade" data-research="${key}" ${research.researched ? 'disabled' : ''}>${research.researched ? 'å·²ç ”ç©¶' : 'ç ”ç©¶'}</button>
                    </div>
                `;
                
                elements.availableResearch.appendChild(researchElement);
            }
        }

        // æ›´æ–°è½¬ç”ŸUI
        function updatePrestigeUI() {
            // è®¡ç®—å¯è·å¾—çš„è½¬ç”Ÿç‚¹æ•°
            let points = 0;
            
            // åŸºäºç­‰çº§
            points += Math.floor(gameState.playerLevel / 10);
            
            // åŸºäºæˆå°±
            points += Math.floor(gameState.achievementPoints / 100);
            
            // åŸºäºå…¶ä»–å› ç´ ...
            
            gameState.prestigePoints = points;
            elements.prestigePoints.textContent = points;
            
            // è®¡ç®—å½“å‰è½¬ç”ŸåŠ æˆç™¾åˆ†æ¯”
            let bonusPercent = 0;
            for (const key in gameState.prestigeBonuses) {
                if (gameState.prestigeBonuses[key].purchased) {
                    bonusPercent += gameState.prestigeBonuses[key].bonus * 100;
                }
            }
            
            elements.prestigeBonus.textContent = bonusPercent;
            
            // æ›´æ–°è½¬ç”Ÿå¥–åŠ±
            const prestigePanel = document.getElementById('prestige-panel');
            const existingRewards = prestigePanel.querySelectorAll('.upgrade-item');
            
            // ç§»é™¤æ—§çš„å¥–åŠ±æ˜¾ç¤ºï¼ˆé™¤äº†ç¬¬ä¸€ä¸ªï¼‰
            for (let i = 1; i < existingRewards.length; i++) {
                existingRewards[i].remove();
            }
            
            // æ·»åŠ è½¬ç”Ÿå¥–åŠ±
            for (const key in gameState.prestigeBonuses) {
                if (key === 'keep-efficiency') continue; // è·³è¿‡ç¬¬ä¸€ä¸ªï¼Œå› ä¸ºå·²ç»å­˜åœ¨
                
                const bonus = gameState.prestigeBonuses[key];
                
                const rewardElement = document.createElement('div');
                rewardElement.className = 'upgrade-item';
                rewardElement.innerHTML = `
                    <div class="upgrade-info">
                        <div class="upgrade-name">${bonus.name}</div>
                        <div class="upgrade-description">${bonus.desc}</div>
                    </div>
                    <div class="upgrade-cost">
                        <div>${bonus.cost}è½¬ç”Ÿç‚¹</div>
                        <button class="button upgrade" data-prestige="${key}" ${bonus.purchased ? 'disabled' : ''}>${bonus.purchased ? 'å·²è§£é”' : 'è§£é”'}</button>
                    </div>
                `;
                
                prestigePanel.insertBefore(rewardElement, elements.prestigeButton);
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            elements.notification.textContent = message;
            elements.notification.style.display = 'block';
            elements.notification.style.animation = 'none';
            void elements.notification.offsetWidth; // è§¦å‘é‡ç»˜
            elements.notification.style.animation = 'fadeInOut 3s forwards';
            
            setTimeout(() => {
                elements.notification.style.display = 'none';
            }, 3000);
        }

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(ms) {
            const seconds = Math.floor(ms / 1000) % 60;
            const minutes = Math.floor(ms / (1000 * 60)) % 60;
            const hours = Math.floor(ms / (1000 * 60 * 60));
            
            return `${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ ${seconds}ç§’`;
        }

        // è·å–éšæœºæ—¶é—´
        function getRandomTime(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        window.onload = initGame;
    </script>
</body>
</html>
